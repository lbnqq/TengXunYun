# 格式对齐和文风对齐功能测试

本目录包含了格式对齐和文风对齐功能的全面测试套件，用于验证系统的稳定性、准确性和性能。

## 测试结构

### 测试文件

- `test_format_alignment.py` - 格式对齐功能测试
- `test_writing_style.py` - 文风对齐功能测试  
- `test_integration.py` - 集成测试
- `run_tests.py` - 测试运行脚本

### 测试覆盖范围

#### 格式对齐测试 (`test_format_alignment.py`)

1. **文档结构分析测试**
   - 标题识别和层级分析
   - 段落和列表识别
   - 特殊元素检测（表格、引用等）
   - 分析置信度评估

2. **格式规则提取测试**
   - 字体信息提取
   - 间距和对齐规则
   - 统计分析准确性
   - 格式一致性验证

3. **HTML模板生成测试**
   - CSS样式生成
   - 字体大小转换
   - 响应式设计支持
   - 模板结构完整性

4. **格式应用测试**
   - 源文档格式转换
   - 目标格式应用
   - 格式冲突处理
   - 输出质量验证

#### 文风对齐测试 (`test_writing_style.py`)

1. **文风特征分析测试**
   - 句式结构分析
   - 词汇选择特征
   - 表达方式识别
   - 情感色彩分析
   - 专业性评估

2. **风格识别测试**
   - 多种文风类型识别
   - 识别准确性验证
   - 置信度评估
   - 边界情况处理

3. **提示词生成测试**
   - 个性化提示词生成
   - 特征驱动的要求生成
   - 避免事项指导
   - 提示词完整性

4. **风格应用验证测试**
   - 一致性分数计算
   - 质量指标评估
   - 改进建议生成
   - 效果验证机制

#### 集成测试 (`test_integration.py`)

1. **端到端流程测试**
   - 格式提取到应用的完整流程
   - 文风分析到验证的完整流程
   - 多文档处理流程

2. **模板管理测试**
   - 模板保存和加载
   - 模板列表管理
   - 模板索引维护

3. **性能测试**
   - 大文档处理性能
   - 并发操作安全性
   - 内存使用优化

4. **错误恢复测试**
   - 异常情况处理
   - 错误恢复机制
   - 系统稳定性

## 运行测试

### 环境要求

- Python 3.7+
- 项目依赖包已安装

### 运行方式

#### 1. 运行所有测试

```bash
cd tests
python run_tests.py
```

#### 2. 运行单个测试文件

```bash
# 格式对齐测试
python -m unittest test_format_alignment.py

# 文风对齐测试  
python -m unittest test_writing_style.py

# 集成测试
python -m unittest test_integration.py
```

#### 3. 运行特定测试方法

```bash
# 运行特定测试类
python -m unittest test_format_alignment.TestFormatAlignment

# 运行特定测试方法
python -m unittest test_format_alignment.TestFormatAlignment.test_document_structure_analysis
```

### 测试输出

运行测试后会生成以下输出：

1. **控制台输出** - 实时测试进度和结果
2. **JSON报告** - `test_report.json` 详细测试数据
3. **HTML报告** - `test_report.html` 可视化测试报告

### 测试报告解读

#### 控制台输出示例

```
==========================================
运行测试套件: 格式对齐测试
==========================================
测试套件 格式对齐测试 完成:
  总计: 12
  通过: 11
  失败: 1
  错误: 0
  耗时: 2.34秒

==========================================
测试报告
==========================================
测试总结:
  总测试数: 35
  通过: 33
  失败: 2
  错误: 0
  成功率: 94.3%
  总耗时: 8.76秒
```

#### HTML报告特性

- 测试结果可视化展示
- 详细的错误信息
- 测试执行时间统计
- 成功率图表显示

## 测试数据

### 测试文档样本

测试使用多种类型的文档样本：

1. **商务报告** - 标准商务文档格式
2. **政府公文** - 正式公文格式
3. **学术论文** - 学术写作风格
4. **叙述文档** - 描述性文风
5. **简洁实用** - 操作指南风格

### 测试用例设计

- **正常情况** - 标准输入和预期输出
- **边界情况** - 空内容、极长内容、特殊字符
- **异常情况** - 无效输入、系统错误、资源不足
- **性能测试** - 大数据量、并发访问、内存限制

## 故障排除

### 常见问题

1. **导入错误**
   ```
   ModuleNotFoundError: No module named 'src'
   ```
   解决：确保从项目根目录运行测试

2. **权限错误**
   ```
   PermissionError: [Errno 13] Permission denied
   ```
   解决：检查临时目录权限，或使用管理员权限

3. **内存不足**
   ```
   MemoryError: Unable to allocate array
   ```
   解决：减少测试数据量或增加系统内存

### 调试技巧

1. **增加详细输出**
   ```bash
   python run_tests.py -v
   ```

2. **运行单个失败的测试**
   ```bash
   python -m unittest test_format_alignment.TestFormatAlignment.test_specific_method -v
   ```

3. **使用调试器**
   ```python
   import pdb; pdb.set_trace()
   ```

## 持续集成

### CI/CD 集成

测试脚本可以集成到CI/CD流水线中：

```yaml
# GitHub Actions 示例
- name: Run Tests
  run: |
    cd tests
    python run_tests.py
```

### 测试覆盖率

建议使用coverage工具检查测试覆盖率：

```bash
pip install coverage
coverage run --source=../src run_tests.py
coverage report
coverage html
```

## 贡献指南

### 添加新测试

1. 在相应的测试文件中添加测试方法
2. 遵循命名约定：`test_功能描述`
3. 包含充分的断言验证
4. 添加必要的文档说明

### 测试最佳实践

1. **独立性** - 每个测试应该独立运行
2. **可重复** - 测试结果应该一致
3. **快速执行** - 避免不必要的延迟
4. **清晰断言** - 使用描述性的断言消息
5. **适当清理** - 测试后清理临时资源

## 更新日志

- **v1.0.0** - 初始测试套件
  - 格式对齐基础测试
  - 文风对齐基础测试
  - 集成测试框架

- **v1.1.0** - 增强测试覆盖
  - 添加性能测试
  - 增加错误处理测试
  - 完善测试报告

- **v1.2.0** - 优化测试框架
  - 改进测试运行器
  - 增加HTML报告
  - 支持并发测试
