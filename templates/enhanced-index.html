<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>办公文档智能代理 - 增强版</title>
    <link rel="stylesheet" href="/static/css/enhanced-ui.css">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <meta name="description" content="智能办公文档处理系统，支持格式对齐、文风统一、智能填报、文档审查等功能">
</head>
<body>
    <div class="app-container">
        <!-- 应用头部 -->
        <header class="app-header">
            <div class="logo">📄 办公文档智能代理</div>
            <nav class="main-nav">
                <a href="#" class="nav-item active" data-scene="format">格式对齐</a>
                <a href="#" class="nav-item" data-scene="style">文风统一</a>
                <a href="#" class="nav-item" data-scene="fill">智能填报</a>
                <a href="#" class="nav-item" data-scene="review">文档审查</a>
                <a href="#" class="nav-item" data-scene="management">管理中心</a>
            </nav>
        </header>

        <!-- 格式对齐场景 -->
        <section id="scene-format" class="scene-section">
            <h2 class="scene-title">📐 格式对齐</h2>
            <p class="scene-description">将文档格式统一到参考模板的标准，确保文档风格一致</p>
            
            <!-- 步骤指示器 -->
            <div class="step-indicator">
                <div class="step-item active">
                    <div class="step-number">1</div>
                    <span>上传文件</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">2</div>
                    <span>格式分析</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">3</div>
                    <span>预览结果</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">4</div>
                    <span>导出文档</span>
                </div>
            </div>

            <!-- 工作流块 -->
            <div class="workflow-block">
                <h3 class="workflow-title">文件上传</h3>
                
                <div class="input-group">
                    <label>参考格式文件:</label>
                    <div class="file-upload-area" id="format-base-upload">
                        <input type="file" accept=".docx,.doc,.txt,.rtf,.pdf" id="upload-format-base">
                        <div class="file-upload-text">点击或拖拽上传参考格式文件</div>
                        <div class="file-upload-hint">支持 .docx, .doc, .txt, .rtf, .pdf 格式</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>待处理文档:</label>
                    <div class="file-upload-area" id="format-target-upload">
                        <input type="file" accept=".docx,.doc,.txt,.rtf,.pdf" id="upload-format-target">
                        <div class="file-upload-text">点击或拖拽上传待处理文档</div>
                        <div class="file-upload-hint">支持 .docx, .doc, .txt, .rtf, .pdf 格式</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>格式模板:</label>
                    <select class="input-select" id="format-template-select">
                        <option value="">选择格式模板</option>
                    </select>
                </div>
            </div>

            <!-- 操作块 -->
            <div class="action-block">
                <h3 class="workflow-title">操作控制</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="format_alignment">
                        <span>🔄</span> 应用格式对齐
                    </button>
                    <button class="btn btn-secondary" data-action="set_baseline">
                        <span>📌</span> 设置基准格式
                    </button>
                    <button class="btn btn-success" data-action="save_format">
                        <span>💾</span> 保存格式模板
                    </button>
                </div>
                
                <div class="feedback-message" id="format-feedback"></div>
            </div>

            <!-- 结果预览区域 -->
            <div class="workflow-block" id="format-result-area" style="display: none;">
                <h3 class="workflow-title">处理结果</h3>
                <div id="format-preview-content"></div>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="preview_result">
                        <span>👁️</span> 预览结果
                    </button>
                    <button class="btn btn-success" data-action="export_result">
                        <span>📥</span> 导出文档
                    </button>
                </div>
            </div>
        </section>

        <!-- 文风统一场景 -->
        <section id="scene-style" class="scene-section hidden">
            <h2 class="scene-title">🎨 文风统一</h2>
            <p class="scene-description">分析参考文档的写作风格，并将其应用到目标文档中</p>
            
            <!-- 步骤指示器 -->
            <div class="step-indicator">
                <div class="step-item active">
                    <div class="step-number">1</div>
                    <span>上传文件</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">2</div>
                    <span>风格分析</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">3</div>
                    <span>预览修改</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">4</div>
                    <span>应用风格</span>
                </div>
            </div>

            <!-- 工作流块 -->
            <div class="workflow-block">
                <h3 class="workflow-title">文件上传</h3>
                
                <div class="input-group">
                    <label>参考文风文档:</label>
                    <div class="file-upload-area" id="style-ref-upload">
                        <input type="file" accept=".docx,.doc,.txt,.rtf,.pdf" id="upload-style-ref">
                        <div class="file-upload-text">点击或拖拽上传参考文风文档</div>
                        <div class="file-upload-hint">支持 .docx, .doc, .txt, .rtf, .pdf 格式</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>目标文档:</label>
                    <div class="file-upload-area" id="style-target-upload">
                        <input type="file" accept=".docx,.doc,.txt,.rtf,.pdf" id="upload-style-target">
                        <div class="file-upload-text">点击或拖拽上传目标文档</div>
                        <div class="file-upload-hint">支持 .docx, .doc, .txt, .rtf, .pdf 格式</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>文风模板:</label>
                    <select class="input-select" id="style-template-select">
                        <option value="">选择文风模板</option>
                    </select>
                </div>
            </div>

            <!-- 操作块 -->
            <div class="action-block">
                <h3 class="workflow-title">操作控制</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="style_alignment">
                        <span>🎨</span> 分析文风
                    </button>
                    <button class="btn btn-secondary" data-action="apply_style">
                        <span>✨</span> 应用风格
                    </button>
                    <button class="btn btn-success" data-action="save_style">
                        <span>💾</span> 保存文风模板
                    </button>
                </div>
                
                <div class="feedback-message" id="style-feedback"></div>
            </div>

            <!-- 结果预览区域 -->
            <div class="workflow-block" id="style-result-area" style="display: none;">
                <h3 class="workflow-title">风格分析结果</h3>
                <div id="style-preview-content"></div>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="preview_style">
                        <span>👁️</span> 预览修改
                    </button>
                    <button class="btn btn-success" data-action="export_style">
                        <span>📥</span> 导出文档
                    </button>
                </div>
            </div>
        </section>

        <!-- 智能填报场景 -->
        <section id="scene-fill" class="scene-section hidden">
            <h2 class="scene-title">🤖 智能填报</h2>
            <p class="scene-description">智能识别文档字段，自动匹配数据源，完成文档填报</p>
            
            <!-- 步骤指示器 -->
            <div class="step-indicator">
                <div class="step-item active">
                    <div class="step-number">1</div>
                    <span>上传模板</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">2</div>
                    <span>字段识别</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">3</div>
                    <span>数据匹配</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">4</div>
                    <span>生成文档</span>
                </div>
            </div>

            <!-- 工作流块 -->
            <div class="workflow-block">
                <h3 class="workflow-title">文档模板</h3>
                
                <div class="input-group">
                    <label>文档模板:</label>
                    <div class="file-upload-area" id="fill-template-upload">
                        <input type="file" accept=".docx,.doc,.txt,.rtf,.pdf" id="upload-fill-template">
                        <div class="file-upload-text">点击或拖拽上传文档模板</div>
                        <div class="file-upload-hint">支持 .docx, .doc, .txt, .rtf, .pdf 格式</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>数据源文件:</label>
                    <div class="file-upload-area" id="fill-data-upload">
                        <input type="file" accept=".json,.csv,.xlsx,.xls" id="upload-fill-data">
                        <div class="file-upload-text">点击或拖拽上传数据源文件</div>
                        <div class="file-upload-hint">支持 .json, .csv, .xlsx, .xls 格式</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>图片文件:</label>
                    <div class="file-upload-area" id="fill-images-upload">
                        <input type="file" accept="image/*" multiple id="upload-fill-images">
                        <div class="file-upload-text">点击或拖拽上传图片文件</div>
                        <div class="file-upload-hint">支持 jpg, png, gif, bmp 格式</div>
                    </div>
                </div>
            </div>

            <!-- 操作块 -->
            <div class="action-block">
                <h3 class="workflow-title">操作控制</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="document_fill">
                        <span>🤖</span> 智能填报
                    </button>
                    <button class="btn btn-secondary" data-action="auto_match">
                        <span>🔍</span> 自动匹配
                    </button>
                    <button class="btn btn-success" data-action="export_fill">
                        <span>📥</span> 导出文档
                    </button>
                </div>
                
                <div class="feedback-message" id="fill-feedback"></div>
            </div>

            <!-- 结果预览区域 -->
            <div class="workflow-block" id="fill-result-area" style="display: none;">
                <h3 class="workflow-title">填报结果</h3>
                <div id="fill-preview-content"></div>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="preview_fill">
                        <span>👁️</span> 预览结果
                    </button>
                    <button class="btn btn-success" data-action="export_filled">
                        <span>📥</span> 导出文档
                    </button>
                </div>
            </div>
        </section>

        <!-- 文档审查场景 -->
        <section id="scene-review" class="scene-section hidden">
            <h2 class="scene-title">🔍 文档审查</h2>
            <p class="scene-description">智能审查文档内容，发现潜在问题并提供修改建议</p>
            
            <!-- 步骤指示器 -->
            <div class="step-indicator">
                <div class="step-item active">
                    <div class="step-number">1</div>
                    <span>上传文档</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">2</div>
                    <span>内容分析</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">3</div>
                    <span>问题识别</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">4</div>
                    <span>修改建议</span>
                </div>
            </div>

            <!-- 工作流块 -->
            <div class="workflow-block">
                <h3 class="workflow-title">文档上传</h3>
                
                <div class="input-group">
                    <label>待审查文档:</label>
                    <div class="file-upload-area" id="review-doc-upload">
                        <input type="file" accept=".docx,.doc,.txt,.rtf,.pdf" id="upload-review-doc">
                        <div class="file-upload-text">点击或拖拽上传待审查文档</div>
                        <div class="file-upload-hint">支持 .docx, .doc, .txt, .rtf, .pdf 格式</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>审查标准:</label>
                    <select class="input-select" id="review-standard-select">
                        <option value="general">通用标准</option>
                        <option value="academic">学术标准</option>
                        <option value="business">商务标准</option>
                        <option value="legal">法律标准</option>
                    </select>
                </div>
            </div>

            <!-- 操作块 -->
            <div class="action-block">
                <h3 class="workflow-title">操作控制</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="document_review">
                        <span>🔍</span> 开始审查
                    </button>
                    <button class="btn btn-secondary" data-action="accept_all">
                        <span>✅</span> 接受所有
                    </button>
                    <button class="btn btn-danger" data-action="reject_all">
                        <span>❌</span> 拒绝所有
                    </button>
                </div>
                
                <div class="feedback-message" id="review-feedback"></div>
            </div>

            <!-- 结果预览区域 -->
            <div class="workflow-block" id="review-result-area" style="display: none;">
                <h3 class="workflow-title">审查结果</h3>
                <div id="review-preview-content"></div>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="preview_review">
                        <span>👁️</span> 预览修改
                    </button>
                    <button class="btn btn-success" data-action="export_review">
                        <span>📥</span> 导出文档
                    </button>
                </div>
            </div>
        </section>

        <!-- 管理中心场景 -->
        <section id="scene-management" class="scene-section hidden">
            <h2 class="scene-title">⚙️ 管理中心</h2>
            <p class="scene-description">管理格式模板、文风模板、文档历史和系统设置</p>

            <!-- 管理标签页 -->
            <div class="workflow-block">
                <div class="tab-buttons">
                    <button class="btn btn-tab active" data-tab="templates">模板管理</button>
                    <button class="btn btn-tab" data-tab="history">文档历史</button>
                    <button class="btn btn-tab" data-tab="settings">系统设置</button>
                </div>

                <!-- 模板管理 -->
                <div class="tab-content active" data-tab-content="templates">
                    <h3 class="workflow-title">格式模板</h3>
                    <div class="template-list" id="format-templates-list">
                        <!-- 模板列表将通过JavaScript动态生成 -->
                    </div>

                    <h3 class="workflow-title">文风模板</h3>
                    <div class="template-list" id="style-templates-list">
                        <!-- 模板列表将通过JavaScript动态生成 -->
                    </div>
                </div>

                <!-- 文档历史 -->
                <div class="tab-content" data-tab-content="history">
                    <h3 class="workflow-title">处理历史</h3>
                    <div class="history-table" id="document-history-table">
                        <!-- 历史记录将通过JavaScript动态生成 -->
                    </div>
                </div>

                <!-- 系统设置 -->
                <div class="tab-content" data-tab-content="settings">
                    <h3 class="workflow-title">系统设置</h3>
                    <div class="settings-form">
                        <div class="input-group">
                            <label>自动保存:</label>
                            <input type="checkbox" id="auto-save-setting" checked>
                        </div>
                        <div class="input-group">
                            <label>显示预览:</label>
                            <input type="checkbox" id="show-preview-setting" checked>
                        </div>
                        <div class="input-group">
                            <label>启用通知:</label>
                            <input type="checkbox" id="enable-notifications-setting" checked>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" data-action="save_settings">
                                <span>💾</span> 保存设置
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 应用底部 -->
        <footer class="app-footer">
            <p>&copy; 2024 办公文档智能代理 - 增强版. 让文档处理更智能、更高效.</p>
        </footer>
    </div>

    <!-- 加载JavaScript文件 -->
    <script src="/static/js/enhanced-app.js"></script>
    <script src="/static/js/enhanced-ui.js"></script>
    <script src="/static/js/enhanced-file-handler.js"></script>
    
    <script>
        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面加载完成，开始初始化增强版应用...');
            
            // 确保所有模块都已加载
            if (window.appState && window.uiManager && window.enhancedFileHandler) {
                console.log('所有模块加载成功');
                
                // 初始化UI管理器
                if (window.uiManager.initializeUI) {
                    window.uiManager.initializeUI();
                }
                
                // 加载初始数据
                loadInitialData();
                
                console.log('应用初始化完成');
            } else {
                console.error('部分模块未加载成功');
            }
        });

        // 加载初始数据
        async function loadInitialData() {
            try {
                // 加载格式模板
                const formatResponse = await fetch('/api/format-templates');
                if (formatResponse.ok) {
                    const formatData = await formatResponse.json();
                    if (formatData.success && Array.isArray(formatData.templates)) {
                        updateFormatSelect(formatData.templates);
                    }
                }

                // 加载文风模板
                const styleResponse = await fetch('/api/writing-style/templates');
                if (styleResponse.ok) {
                    const styleData = await styleResponse.json();
                    if (styleData.success && Array.isArray(styleData.templates)) {
                        updateStyleSelect(styleData.templates);
                    }
                }

                // 加载文档历史
                const historyResponse = await fetch('/api/documents/history');
                if (historyResponse.ok) {
                    const historyData = await historyResponse.json();
                    if (historyData.success && Array.isArray(historyData.history)) {
                        updateHistoryTable(historyData.history);
                    }
                }
            } catch (error) {
                console.error('加载初始数据失败:', error);
                if (window.errorHandler) {
                    window.errorHandler.handleError(error, 'initial_data_loading');
                }
            }
        }

        // 更新格式模板选择器
        function updateFormatSelect(templates) {
            const select = document.getElementById('format-template-select');
            if (select) {
                select.innerHTML = '<option value="">选择格式模板</option>';
                templates.forEach(template => {
                    const option = document.createElement('option');
                    option.value = template.id;
                    option.textContent = template.name;
                    select.appendChild(option);
                });
            }
        }

        // 更新文风模板选择器
        function updateStyleSelect(templates) {
            const select = document.getElementById('style-template-select');
            if (select) {
                select.innerHTML = '<option value="">选择文风模板</option>';
                templates.forEach(template => {
                    const option = document.createElement('option');
                    option.value = template.id;
                    option.textContent = template.name;
                    select.appendChild(option);
                });
            }
        }

        // 更新历史记录表格
        function updateHistoryTable(history) {
            const table = document.getElementById('document-history-table');
            if (table) {
                table.innerHTML = `
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>时间</th>
                                <th>操作类型</th>
                                <th>文件名</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${history.map(record => `
                                <tr>
                                    <td>${new Date(record.timestamp).toLocaleString()}</td>
                                    <td>${record.operation_type}</td>
                                    <td>${record.filename}</td>
                                    <td>${record.status}</td>
                                    <td>
                                        <button class="btn btn-small" onclick="reapplyOperation('${record.id}')">
                                            重新应用
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
        }

        // 重新应用操作
        function reapplyOperation(recordId) {
            console.log('重新应用操作:', recordId);
            // 实现重新应用逻辑
        }
    </script>
</body>
</html> 