<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠå…¬æ–‡æ¡£æ™ºèƒ½ä»£ç† - å¢å¼ºç‰ˆ</title>
    <link rel="stylesheet" href="/static/css/enhanced-ui.css">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <meta name="description" content="æ™ºèƒ½åŠå…¬æ–‡æ¡£å¤„ç†ç³»ç»Ÿï¼Œæ”¯æŒæ ¼å¼å¯¹é½ã€æ–‡é£ç»Ÿä¸€ã€æ™ºèƒ½å¡«æŠ¥ã€æ–‡æ¡£å®¡æŸ¥ç­‰åŠŸèƒ½">
</head>
<body>
    <div class="app-container">
        <!-- åº”ç”¨å¤´éƒ¨ -->
        <header class="app-header">
            <div class="logo">ğŸ“„ åŠå…¬æ–‡æ¡£æ™ºèƒ½ä»£ç†</div>
            <nav class="main-nav">
                <a href="#" class="nav-item active" data-scene="format">æ ¼å¼å¯¹é½</a>
                <a href="#" class="nav-item" data-scene="style">æ–‡é£ç»Ÿä¸€</a>
                <a href="#" class="nav-item" data-scene="fill">æ™ºèƒ½å¡«æŠ¥</a>
                <a href="#" class="nav-item" data-scene="review">æ–‡æ¡£å®¡æŸ¥</a>
                <a href="#" class="nav-item" data-scene="management">ç®¡ç†ä¸­å¿ƒ</a>
            </nav>
        </header>

        <!-- æ ¼å¼å¯¹é½åœºæ™¯ -->
        <section id="scene-format" class="scene-section">
            <h2 class="scene-title">ğŸ“ æ ¼å¼å¯¹é½</h2>
            <p class="scene-description">å°†æ–‡æ¡£æ ¼å¼ç»Ÿä¸€åˆ°å‚è€ƒæ¨¡æ¿çš„æ ‡å‡†ï¼Œç¡®ä¿æ–‡æ¡£é£æ ¼ä¸€è‡´</p>
            
            <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <div class="step-indicator">
                <div class="step-item active">
                    <div class="step-number">1</div>
                    <span>ä¸Šä¼ æ–‡ä»¶</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">2</div>
                    <span>æ ¼å¼åˆ†æ</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">3</div>
                    <span>é¢„è§ˆç»“æœ</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">4</div>
                    <span>å¯¼å‡ºæ–‡æ¡£</span>
                </div>
            </div>

            <!-- å·¥ä½œæµå— -->
            <div class="workflow-block">
                <h3 class="workflow-title">æ–‡ä»¶ä¸Šä¼ </h3>
                
                <div class="input-group">
                    <label>å‚è€ƒæ ¼å¼æ–‡ä»¶:</label>
                    <div class="file-upload-area" id="format-base-upload">
                        <input type="file" accept=".docx,.doc,.txt,.rtf,.pdf" id="upload-format-base">
                        <div class="file-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å‚è€ƒæ ¼å¼æ–‡ä»¶</div>
                        <div class="file-upload-hint">æ”¯æŒ .docx, .doc, .txt, .rtf, .pdf æ ¼å¼</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>å¾…å¤„ç†æ–‡æ¡£:</label>
                    <div class="file-upload-area" id="format-target-upload">
                        <input type="file" accept=".docx,.doc,.txt,.rtf,.pdf" id="upload-format-target">
                        <div class="file-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å¾…å¤„ç†æ–‡æ¡£</div>
                        <div class="file-upload-hint">æ”¯æŒ .docx, .doc, .txt, .rtf, .pdf æ ¼å¼</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>æ ¼å¼æ¨¡æ¿:</label>
                    <select class="input-select" id="format-template-select">
                        <option value="">é€‰æ‹©æ ¼å¼æ¨¡æ¿</option>
                    </select>
                </div>
            </div>

            <!-- æ“ä½œå— -->
            <div class="action-block">
                <h3 class="workflow-title">æ“ä½œæ§åˆ¶</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="format_alignment">
                        <span>ğŸ”„</span> åº”ç”¨æ ¼å¼å¯¹é½
                    </button>
                    <button class="btn btn-secondary" data-action="set_baseline">
                        <span>ğŸ“Œ</span> è®¾ç½®åŸºå‡†æ ¼å¼
                    </button>
                    <button class="btn btn-success" data-action="save_format">
                        <span>ğŸ’¾</span> ä¿å­˜æ ¼å¼æ¨¡æ¿
                    </button>
                </div>
                
                <div class="feedback-message" id="format-feedback"></div>
            </div>

            <!-- ç»“æœé¢„è§ˆåŒºåŸŸ -->
            <div class="workflow-block" id="format-result-area" style="display: none;">
                <h3 class="workflow-title">å¤„ç†ç»“æœ</h3>
                <div id="format-preview-content"></div>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="preview_result">
                        <span>ğŸ‘ï¸</span> é¢„è§ˆç»“æœ
                    </button>
                    <button class="btn btn-success" data-action="export_result">
                        <span>ğŸ“¥</span> å¯¼å‡ºæ–‡æ¡£
                    </button>
                </div>
            </div>
        </section>

        <!-- æ–‡é£ç»Ÿä¸€åœºæ™¯ -->
        <section id="scene-style" class="scene-section hidden">
            <h2 class="scene-title">ğŸ¨ æ–‡é£ç»Ÿä¸€</h2>
            <p class="scene-description">åˆ†æå‚è€ƒæ–‡æ¡£çš„å†™ä½œé£æ ¼ï¼Œå¹¶å°†å…¶åº”ç”¨åˆ°ç›®æ ‡æ–‡æ¡£ä¸­</p>
            
            <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <div class="step-indicator">
                <div class="step-item active">
                    <div class="step-number">1</div>
                    <span>ä¸Šä¼ æ–‡ä»¶</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">2</div>
                    <span>é£æ ¼åˆ†æ</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">3</div>
                    <span>é¢„è§ˆä¿®æ”¹</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">4</div>
                    <span>åº”ç”¨é£æ ¼</span>
                </div>
            </div>

            <!-- å·¥ä½œæµå— -->
            <div class="workflow-block">
                <h3 class="workflow-title">æ–‡ä»¶ä¸Šä¼ </h3>
                
                <div class="input-group">
                    <label>å‚è€ƒæ–‡é£æ–‡æ¡£:</label>
                    <div class="file-upload-area" id="style-ref-upload">
                        <input type="file" accept=".docx,.doc,.txt,.rtf,.pdf" id="upload-style-ref">
                        <div class="file-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å‚è€ƒæ–‡é£æ–‡æ¡£</div>
                        <div class="file-upload-hint">æ”¯æŒ .docx, .doc, .txt, .rtf, .pdf æ ¼å¼</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>ç›®æ ‡æ–‡æ¡£:</label>
                    <div class="file-upload-area" id="style-target-upload">
                        <input type="file" accept=".docx,.doc,.txt,.rtf,.pdf" id="upload-style-target">
                        <div class="file-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ ç›®æ ‡æ–‡æ¡£</div>
                        <div class="file-upload-hint">æ”¯æŒ .docx, .doc, .txt, .rtf, .pdf æ ¼å¼</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>æ–‡é£æ¨¡æ¿:</label>
                    <select class="input-select" id="style-template-select">
                        <option value="">é€‰æ‹©æ–‡é£æ¨¡æ¿</option>
                    </select>
                </div>
            </div>

            <!-- æ“ä½œå— -->
            <div class="action-block">
                <h3 class="workflow-title">æ“ä½œæ§åˆ¶</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="style_alignment">
                        <span>ğŸ¨</span> åˆ†ææ–‡é£
                    </button>
                    <button class="btn btn-secondary" data-action="apply_style">
                        <span>âœ¨</span> åº”ç”¨é£æ ¼
                    </button>
                    <button class="btn btn-success" data-action="save_style">
                        <span>ğŸ’¾</span> ä¿å­˜æ–‡é£æ¨¡æ¿
                    </button>
                </div>
                
                <div class="feedback-message" id="style-feedback"></div>
            </div>

            <!-- ç»“æœé¢„è§ˆåŒºåŸŸ -->
            <div class="workflow-block" id="style-result-area" style="display: none;">
                <h3 class="workflow-title">é£æ ¼åˆ†æç»“æœ</h3>
                <div id="style-preview-content"></div>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="preview_style">
                        <span>ğŸ‘ï¸</span> é¢„è§ˆä¿®æ”¹
                    </button>
                    <button class="btn btn-success" data-action="export_style">
                        <span>ğŸ“¥</span> å¯¼å‡ºæ–‡æ¡£
                    </button>
                </div>
            </div>
        </section>

        <!-- æ™ºèƒ½å¡«æŠ¥åœºæ™¯ -->
        <section id="scene-fill" class="scene-section hidden">
            <h2 class="scene-title">ğŸ¤– æ™ºèƒ½å¡«æŠ¥</h2>
            <p class="scene-description">æ™ºèƒ½è¯†åˆ«æ–‡æ¡£å­—æ®µï¼Œè‡ªåŠ¨åŒ¹é…æ•°æ®æºï¼Œå®Œæˆæ–‡æ¡£å¡«æŠ¥</p>
            
            <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <div class="step-indicator">
                <div class="step-item active">
                    <div class="step-number">1</div>
                    <span>ä¸Šä¼ æ¨¡æ¿</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">2</div>
                    <span>å­—æ®µè¯†åˆ«</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">3</div>
                    <span>æ•°æ®åŒ¹é…</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">4</div>
                    <span>ç”Ÿæˆæ–‡æ¡£</span>
                </div>
            </div>

            <!-- å·¥ä½œæµå— -->
            <div class="workflow-block">
                <h3 class="workflow-title">æ–‡æ¡£æ¨¡æ¿</h3>
                
                <div class="input-group">
                    <label>æ–‡æ¡£æ¨¡æ¿:</label>
                    <div class="file-upload-area" id="fill-template-upload">
                        <input type="file" accept=".docx,.doc,.txt,.rtf,.pdf" id="upload-fill-template">
                        <div class="file-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ æ–‡æ¡£æ¨¡æ¿</div>
                        <div class="file-upload-hint">æ”¯æŒ .docx, .doc, .txt, .rtf, .pdf æ ¼å¼</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>æ•°æ®æºæ–‡ä»¶:</label>
                    <div class="file-upload-area" id="fill-data-upload">
                        <input type="file" accept=".json,.csv,.xlsx,.xls" id="upload-fill-data">
                        <div class="file-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ æ•°æ®æºæ–‡ä»¶</div>
                        <div class="file-upload-hint">æ”¯æŒ .json, .csv, .xlsx, .xls æ ¼å¼</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>å›¾ç‰‡æ–‡ä»¶:</label>
                    <div class="file-upload-area" id="fill-images-upload">
                        <input type="file" accept="image/*" multiple id="upload-fill-images">
                        <div class="file-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶</div>
                        <div class="file-upload-hint">æ”¯æŒ jpg, png, gif, bmp æ ¼å¼</div>
                    </div>
                </div>
            </div>

            <!-- æ“ä½œå— -->
            <div class="action-block">
                <h3 class="workflow-title">æ“ä½œæ§åˆ¶</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="document_fill">
                        <span>ğŸ¤–</span> æ™ºèƒ½å¡«æŠ¥
                    </button>
                    <button class="btn btn-secondary" data-action="auto_match">
                        <span>ğŸ”</span> è‡ªåŠ¨åŒ¹é…
                    </button>
                    <button class="btn btn-success" data-action="export_fill">
                        <span>ğŸ“¥</span> å¯¼å‡ºæ–‡æ¡£
                    </button>
                </div>
                
                <div class="feedback-message" id="fill-feedback"></div>
            </div>

            <!-- ç»“æœé¢„è§ˆåŒºåŸŸ -->
            <div class="workflow-block" id="fill-result-area" style="display: none;">
                <h3 class="workflow-title">å¡«æŠ¥ç»“æœ</h3>
                <div id="fill-preview-content"></div>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="preview_fill">
                        <span>ğŸ‘ï¸</span> é¢„è§ˆç»“æœ
                    </button>
                    <button class="btn btn-success" data-action="export_filled">
                        <span>ğŸ“¥</span> å¯¼å‡ºæ–‡æ¡£
                    </button>
                </div>
            </div>
        </section>

        <!-- æ–‡æ¡£å®¡æŸ¥åœºæ™¯ -->
        <section id="scene-review" class="scene-section hidden">
            <h2 class="scene-title">ğŸ” æ–‡æ¡£å®¡æŸ¥</h2>
            <p class="scene-description">æ™ºèƒ½å®¡æŸ¥æ–‡æ¡£å†…å®¹ï¼Œå‘ç°æ½œåœ¨é—®é¢˜å¹¶æä¾›ä¿®æ”¹å»ºè®®</p>
            
            <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <div class="step-indicator">
                <div class="step-item active">
                    <div class="step-number">1</div>
                    <span>ä¸Šä¼ æ–‡æ¡£</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">2</div>
                    <span>å†…å®¹åˆ†æ</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">3</div>
                    <span>é—®é¢˜è¯†åˆ«</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                    <div class="step-number">4</div>
                    <span>ä¿®æ”¹å»ºè®®</span>
                </div>
            </div>

            <!-- å·¥ä½œæµå— -->
            <div class="workflow-block">
                <h3 class="workflow-title">æ–‡æ¡£ä¸Šä¼ </h3>
                
                <div class="input-group">
                    <label>å¾…å®¡æŸ¥æ–‡æ¡£:</label>
                    <div class="file-upload-area" id="review-doc-upload">
                        <input type="file" accept=".docx,.doc,.txt,.rtf,.pdf" id="upload-review-doc">
                        <div class="file-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å¾…å®¡æŸ¥æ–‡æ¡£</div>
                        <div class="file-upload-hint">æ”¯æŒ .docx, .doc, .txt, .rtf, .pdf æ ¼å¼</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>å®¡æŸ¥æ ‡å‡†:</label>
                    <select class="input-select" id="review-standard-select">
                        <option value="general">é€šç”¨æ ‡å‡†</option>
                        <option value="academic">å­¦æœ¯æ ‡å‡†</option>
                        <option value="business">å•†åŠ¡æ ‡å‡†</option>
                        <option value="legal">æ³•å¾‹æ ‡å‡†</option>
                    </select>
                </div>
            </div>

            <!-- æ“ä½œå— -->
            <div class="action-block">
                <h3 class="workflow-title">æ“ä½œæ§åˆ¶</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="document_review">
                        <span>ğŸ”</span> å¼€å§‹å®¡æŸ¥
                    </button>
                    <button class="btn btn-secondary" data-action="accept_all">
                        <span>âœ…</span> æ¥å—æ‰€æœ‰
                    </button>
                    <button class="btn btn-danger" data-action="reject_all">
                        <span>âŒ</span> æ‹’ç»æ‰€æœ‰
                    </button>
                </div>
                
                <div class="feedback-message" id="review-feedback"></div>
            </div>

            <!-- ç»“æœé¢„è§ˆåŒºåŸŸ -->
            <div class="workflow-block" id="review-result-area" style="display: none;">
                <h3 class="workflow-title">å®¡æŸ¥ç»“æœ</h3>
                <div id="review-preview-content"></div>
                <div class="action-buttons">
                    <button class="btn btn-primary" data-action="preview_review">
                        <span>ğŸ‘ï¸</span> é¢„è§ˆä¿®æ”¹
                    </button>
                    <button class="btn btn-success" data-action="export_review">
                        <span>ğŸ“¥</span> å¯¼å‡ºæ–‡æ¡£
                    </button>
                </div>
            </div>
        </section>

        <!-- ç®¡ç†ä¸­å¿ƒåœºæ™¯ -->
        <section id="scene-management" class="scene-section hidden">
            <h2 class="scene-title">âš™ï¸ ç®¡ç†ä¸­å¿ƒ</h2>
            <p class="scene-description">ç®¡ç†æ ¼å¼æ¨¡æ¿ã€æ–‡é£æ¨¡æ¿ã€æ–‡æ¡£å†å²å’Œç³»ç»Ÿè®¾ç½®</p>

            <!-- ç®¡ç†æ ‡ç­¾é¡µ -->
            <div class="workflow-block">
                <div class="tab-buttons">
                    <button class="btn btn-tab active" data-tab="templates">æ¨¡æ¿ç®¡ç†</button>
                    <button class="btn btn-tab" data-tab="history">æ–‡æ¡£å†å²</button>
                    <button class="btn btn-tab" data-tab="settings">ç³»ç»Ÿè®¾ç½®</button>
                </div>

                <!-- æ¨¡æ¿ç®¡ç† -->
                <div class="tab-content active" data-tab-content="templates">
                    <h3 class="workflow-title">æ ¼å¼æ¨¡æ¿</h3>
                    <div class="template-list" id="format-templates-list">
                        <!-- æ¨¡æ¿åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <h3 class="workflow-title">æ–‡é£æ¨¡æ¿</h3>
                    <div class="template-list" id="style-templates-list">
                        <!-- æ¨¡æ¿åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- æ–‡æ¡£å†å² -->
                <div class="tab-content" data-tab-content="history">
                    <h3 class="workflow-title">å¤„ç†å†å²</h3>
                    <div class="history-table" id="document-history-table">
                        <!-- å†å²è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- ç³»ç»Ÿè®¾ç½® -->
                <div class="tab-content" data-tab-content="settings">
                    <h3 class="workflow-title">ç³»ç»Ÿè®¾ç½®</h3>
                    <div class="settings-form">
                        <div class="input-group">
                            <label>è‡ªåŠ¨ä¿å­˜:</label>
                            <input type="checkbox" id="auto-save-setting" checked>
                        </div>
                        <div class="input-group">
                            <label>æ˜¾ç¤ºé¢„è§ˆ:</label>
                            <input type="checkbox" id="show-preview-setting" checked>
                        </div>
                        <div class="input-group">
                            <label>å¯ç”¨é€šçŸ¥:</label>
                            <input type="checkbox" id="enable-notifications-setting" checked>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" data-action="save_settings">
                                <span>ğŸ’¾</span> ä¿å­˜è®¾ç½®
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- åº”ç”¨åº•éƒ¨ -->
        <footer class="app-footer">
            <p>&copy; 2024 åŠå…¬æ–‡æ¡£æ™ºèƒ½ä»£ç† - å¢å¼ºç‰ˆ. è®©æ–‡æ¡£å¤„ç†æ›´æ™ºèƒ½ã€æ›´é«˜æ•ˆ.</p>
        </footer>
    </div>

    <!-- åŠ è½½JavaScriptæ–‡ä»¶ -->
    <script src="/static/js/enhanced-app.js"></script>
    <script src="/static/js/enhanced-ui.js"></script>
    <script src="/static/js/enhanced-file-handler.js"></script>
    
    <script>
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–å¢å¼ºç‰ˆåº”ç”¨...');
            
            // ç¡®ä¿æ‰€æœ‰æ¨¡å—éƒ½å·²åŠ è½½
            if (window.appState && window.uiManager && window.enhancedFileHandler) {
                console.log('æ‰€æœ‰æ¨¡å—åŠ è½½æˆåŠŸ');
                
                // åˆå§‹åŒ–UIç®¡ç†å™¨
                if (window.uiManager.initializeUI) {
                    window.uiManager.initializeUI();
                }
                
                // åŠ è½½åˆå§‹æ•°æ®
                loadInitialData();
                
                console.log('åº”ç”¨åˆå§‹åŒ–å®Œæˆ');
            } else {
                console.error('éƒ¨åˆ†æ¨¡å—æœªåŠ è½½æˆåŠŸ');
            }
        });

        // åŠ è½½åˆå§‹æ•°æ®
        async function loadInitialData() {
            try {
                // åŠ è½½æ ¼å¼æ¨¡æ¿
                const formatResponse = await fetch('/api/format-templates');
                if (formatResponse.ok) {
                    const formatData = await formatResponse.json();
                    if (formatData.success && Array.isArray(formatData.templates)) {
                        updateFormatSelect(formatData.templates);
                    }
                }

                // åŠ è½½æ–‡é£æ¨¡æ¿
                const styleResponse = await fetch('/api/writing-style/templates');
                if (styleResponse.ok) {
                    const styleData = await styleResponse.json();
                    if (styleData.success && Array.isArray(styleData.templates)) {
                        updateStyleSelect(styleData.templates);
                    }
                }

                // åŠ è½½æ–‡æ¡£å†å²
                const historyResponse = await fetch('/api/documents/history');
                if (historyResponse.ok) {
                    const historyData = await historyResponse.json();
                    if (historyData.success && Array.isArray(historyData.history)) {
                        updateHistoryTable(historyData.history);
                    }
                }
            } catch (error) {
                console.error('åŠ è½½åˆå§‹æ•°æ®å¤±è´¥:', error);
                if (window.errorHandler) {
                    window.errorHandler.handleError(error, 'initial_data_loading');
                }
            }
        }

        // æ›´æ–°æ ¼å¼æ¨¡æ¿é€‰æ‹©å™¨
        function updateFormatSelect(templates) {
            const select = document.getElementById('format-template-select');
            if (select) {
                select.innerHTML = '<option value="">é€‰æ‹©æ ¼å¼æ¨¡æ¿</option>';
                templates.forEach(template => {
                    const option = document.createElement('option');
                    option.value = template.id;
                    option.textContent = template.name;
                    select.appendChild(option);
                });
            }
        }

        // æ›´æ–°æ–‡é£æ¨¡æ¿é€‰æ‹©å™¨
        function updateStyleSelect(templates) {
            const select = document.getElementById('style-template-select');
            if (select) {
                select.innerHTML = '<option value="">é€‰æ‹©æ–‡é£æ¨¡æ¿</option>';
                templates.forEach(template => {
                    const option = document.createElement('option');
                    option.value = template.id;
                    option.textContent = template.name;
                    select.appendChild(option);
                });
            }
        }

        // æ›´æ–°å†å²è®°å½•è¡¨æ ¼
        function updateHistoryTable(history) {
            const table = document.getElementById('document-history-table');
            if (table) {
                table.innerHTML = `
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>æ—¶é—´</th>
                                <th>æ“ä½œç±»å‹</th>
                                <th>æ–‡ä»¶å</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${history.map(record => `
                                <tr>
                                    <td>${new Date(record.timestamp).toLocaleString()}</td>
                                    <td>${record.operation_type}</td>
                                    <td>${record.filename}</td>
                                    <td>${record.status}</td>
                                    <td>
                                        <button class="btn btn-small" onclick="reapplyOperation('${record.id}')">
                                            é‡æ–°åº”ç”¨
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
        }

        // é‡æ–°åº”ç”¨æ“ä½œ
        function reapplyOperation(recordId) {
            console.log('é‡æ–°åº”ç”¨æ“ä½œ:', recordId);
            // å®ç°é‡æ–°åº”ç”¨é€»è¾‘
        }
    </script>
</body>
</html> 