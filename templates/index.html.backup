<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>办公文档智能代理</title>
    <link rel="stylesheet" href="/static/css/enhanced-ui.css">
    <style>
        /* Fallback styles if CSS file fails to load */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .app-header {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
        }
        .main-nav {
            display: flex;
            gap: 20px;
        }
        .nav-item {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
        }
        .nav-item.active {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .scene-section {
            margin-top: 20px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .scene-section.hidden {
            display: none;
        }
        .scene-title {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .scene-description {
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
        }
        .workflow-block {
            margin-bottom: 20px;
        }
        .workflow-title {
            font-size: 18px;
            margin-bottom: 10px;
        }
        .input-group {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        label {
            width: 120px;
            font-weight: bold;
        }
        .input-file, .input-select, .input-text, .input-textarea {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            flex-grow: 1;
        }
        .input-textarea {
            height: 100px;
            resize: vertical;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }
        .action-block {
            margin-top: 20px;
        }
        .feedback-message {
            margin-top: 10px;
            color: #28a745;
            display: none;
        }
        .app-footer {
            margin-top: 40px;
            padding: 20px;
            text-align: center;
            background-color: #e9ecef;
        }
        .enhanced-preview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            color: white;
        }
        
        .enhanced-preview h3 {
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .preview-content {
            background: rgba(255,255,255,0.95);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            color: #333;
            max-height: 500px;
            overflow-y: auto;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .preview-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .preview-actions .btn {
            border-radius: 25px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .preview-actions .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .svg-container {
            margin: 20px 0;
            text-align: center;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            background: #f8f9fa;
        }
        
        .svg-container h4 {
            color: #495057;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .svg-caption {
            color: #6c757d;
            font-style: italic;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .svg-container svg {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .action-buttons .btn {
            border-radius: 25px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .action-buttons .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }
        
        .btn-info {
            background: linear-gradient(45deg, #17a2b8, #20c997);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #ffc107, #fd7e14);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #6c757d, #495057);
            color: white;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 1. Header & Navigation -->
        <header class="app-header">
            <div class="app-header-content">
                <div class="logo">智文档</div>
                <nav class="main-nav">
                    <a href="#scene-format" class="nav-item tab-btn active" data-scene="format">格式统一</a>
                    <a href="#scene-style" class="nav-item tab-btn" data-scene="style">文风统一</a>
                    <a href="#scene-fill" class="nav-item tab-btn" data-scene="fill">智能填报</a>
                    <a href="#scene-review" class="nav-item tab-btn" data-scene="review">文档审阅</a>
                    <a href="#scene-manage" class="nav-item tab-btn" data-scene="manage">管理中心</a>
                </nav>
            </div>
        </header>

        <!-- 2. Main Content Area -->
        <main class="app-main">
            <div class="container">
                <!-- --- 场景：格式统一 --- -->
                <section id="scene-format" class="scene-section">
                    <h2 class="scene-title">统一文档格式</h2>
                    <p class="scene-description">确保您的文档符合标准格式要求。</p>
                    
                    <div id="upload-area" class="workflow-block">
                        <h3 class="workflow-title">1. 选择格式基准</h3>
                        <div class="input-group">
                            <label for="file-input">上传参考格式:</label>
                            <input type="file" id="file-input" class="input-file">
                            <span id="file-info" class="input-file-name"></span>
                            <button class="btn btn-secondary btn-set-baseline">设为基准</button>
                        </div>
                        <div class="input-group">
                            <label for="saved-format-select">或选择已保存:</label>
                            <select id="saved-format-select" class="input-select">
                                <option value="">-- 选择格式 --</option>
                                <option value="company-v1">公司报告 V1</option>
                                <option value="contract-std">合同标准</option>
                            </select>
                            <a href="#scene-manage" class="link-to-manage">管理</a>
                        </div>
                    </div>

                    <div class="workflow-block">
                        <h3 class="workflow-title">2. 选择待处理文档</h3>
                        <div class="input-group">
                            <label for="upload-format-target">上传文档:</label>
                            <input type="file" id="upload-format-target" class="input-file">
                            <span class="input-file-name"></span>
                        </div>
                    </div>

                    <div class="action-block">
                        <button id="process-btn" class="btn btn-primary btn-apply-format">立即统一格式</button>
                        <div class="feedback-message"></div>
                    </div>
                    
                    <!-- SVG相关操作按钮 -->
                    <div class="action-buttons">
                        <button onclick="previewDocument()" class="btn btn-primary">
                            <i class="fas fa-eye"></i> 预览文档
                        </button>
                        <button onclick="exportDocument()" class="btn btn-success">
                            <i class="fas fa-download"></i> 导出文档
                        </button>
                        <button onclick="enhancedPreview()" class="btn btn-info">
                            <i class="fas fa-magic"></i> 增强预览
                        </button>
                        <button onclick="enhancedExport()" class="btn btn-warning">
                            <i class="fas fa-star"></i> 增强导出
                        </button>
                        <button onclick="regenerateSVG()" class="btn btn-secondary">
                            <i class="fas fa-sync"></i> 重新生成SVG
                        </button>
                    </div>

                    <!-- 预览容器 -->
                    <div id="preview-container" style="display: none;">
                        <!-- 预览内容将在这里显示 -->
                    </div>

                    <div id="error-section" class="feedback-message hidden">
                        <p>错误信息将会显示在这里。</p>
                    </div>

                    <div class="utility-block">
                        <h3 class="utility-title">保存当前格式</h3>
                        <div class="input-group">
                            <label for="save-format-name">新格式名:</label>
                            <input type="text" id="save-format-name" class="input-text" placeholder="例如：项目报告">
                            <button class="btn btn-secondary btn-save-format">保存</button>
                        </div>
                    </div>
                </section>

                <!-- --- 场景：文风统一 --- -->
                <section id="scene-style" class="scene-section hidden">
                    <h2 class="scene-title">统一文档文风</h2>
                    <p class="scene-description">让您的文档风格保持一致，提升专业度。</p>
                    
                    <div class="workflow-block">
                        <h3 class="workflow-title">1. 选择参考文风</h3>
                        <div class="input-group">
                            <label for="upload-style-ref">上传参考文档:</label>
                            <input type="file" id="upload-style-ref" class="input-file">
                            <span class="input-file-name"></span>
                            <button class="btn btn-secondary btn-analyze-style" id="analyze-style-btn">分析文风</button>
                        </div>
                        <div class="input-group">
                            <label for="saved-style-select">或选择已保存:</label>
                            <select id="saved-style-select" class="input-select">
                                <option value="">-- 选择文风 --</option>
                                <option value="business-formal">商务正式</option>
                                <option value="academic-concise">学术简洁</option>
                            </select>
                            <a href="#scene-manage" class="link-to-manage">管理</a>
                        </div>
                    </div>

                    <div class="workflow-block">
                        <h3 class="workflow-title">2. 选择待处理文档</h3>
                        <div class="input-group">
                            <label for="upload-style-target">上传文档:</label>
                            <input type="file" id="upload-style-target" class="input-file">
                            <span class="input-file-name"></span>
                        </div>
                    </div>

                    <div class="action-block">
                        <button class="btn btn-primary btn-apply-style">立即统一文风</button>
                        <div class="feedback-message"></div>
                    </div>

                    <!-- 结果预览与管理 -->
                    <div class="result-preview-block hidden">
                        <h3 class="result-title">文风调整结果</h3>
                        <div class="document-preview-placeholder">
                            <!-- 此处为模拟预览区域，展示高亮和建议 -->
                            <p>原文第一段。</p>
                            <p class="highlighted-change">AI修改后的句子，以匹配参考文风。</p>
                            <p>原文第三段。</p>
                        </div>
                        <div class="result-actions">
                            <button class="btn btn-secondary btn-accept-all-style">接受所有修改</button>
                            <button class="btn btn-danger btn-reject-all-style">拒绝所有修改</button>
                            <button class="btn btn-primary btn-export-styled-doc">导出调整后文档</button>
                        </div>
                    </div>

                    <div class="utility-block">
                        <h3 class="utility-title">保存当前文风</h3>
                        <div class="input-group">
                            <label for="save-style-name">新文风名:</label>
                            <input type="text" id="save-style-name" class="input-text" placeholder="例如：商务简洁">
                            <button class="btn btn-secondary btn-save-style">保存</button>
                        </div>
                    </div>

                    <!-- 文风分析文本输入及按钮 -->
                    <div class="input-group">
                        <label for="style-text-input">输入待分析文本:</label>
                        <textarea id="style-text-input" class="input-textarea" placeholder="请输入要分析的文本"></textarea>
                        <button class="btn btn-secondary" id="analyze-text-btn">分析文本</button>
                    </div>
                    <!-- 文风分析文件上传区及信息展示 -->
                    <div id="style-analysis-upload" class="input-group">
                        <label for="style-analysis-input">上传文风分析文件:</label>
                        <input type="file" id="style-analysis-input" class="input-file">
                    </div>
                    <div id="style-file-info" class="input-group hidden">
                        <span id="style-file-name"></span>
                        <span id="style-file-size"></span>
                        <button class="btn btn-secondary" id="clear-style-file">清除文件</button>
                    </div>
                    <div id="style-analysis-result"></div>
                </section>

                <!-- --- 场景：智能填报 --- -->
                <section id="scene-fill" class="scene-section hidden">
                    <h2 class="scene-title">智能填报复杂文档</h2>
                    <p class="scene-description">自动将您的数据填入文档模板，精确高效。</p>
                    
                    <div class="workflow-block">
                        <h3 class="workflow-title">1. 上传文档模板</h3>
                        <div class="input-group">
                            <label for="upload-fill-template">上传模板:</label>
                            <input type="file" id="upload-fill-template" class="input-file">
                            <span class="input-file-name"></span>
                            <div class="processing-status-indicator">AI识别结构中...</div>
                        </div>
                    </div>

                    <div class="workflow-block">
                        <h3 class="workflow-title">2. 准备与匹配数据</h3>
                        <div class="data-input-area">
                            <div class="data-input-group">
                                <label for="fill-text-data">文本数据:</label>
                                <textarea id="fill-text-data" class="input-textarea" placeholder="粘贴文本或手动输入"></textarea>
                            </div>
                            <div class="data-input-group">
                                <label for="upload-fill-data-files">文件数据:</label>
                                <input type="file" id="upload-fill-data-files" class="input-file" multiple>
                                <span class="input-file-name"></span>
                                <!-- TODO: 动态展示已上传文件列表 -->
                            </div>
                        </div>
                        <button class="btn btn-secondary btn-auto-match-data">自动匹配数据</button>
                    </div>

                    <div class="workflow-block">
                        <h3 class="workflow-title">3. 预览与调整</h3>
                        <div class="document-preview-placeholder fill-preview">
                            <!-- 模拟填报预览，字段高亮，可编辑 -->
                            <p>姓名: <span class="field-value matched" data-field="姓名">张三</span></p>
                            <p>地址: <input type="text" class="field-input" placeholder="待填写" data-field="地址"></p>
                            <p>金额: <span class="field-value" data-field="金额">1200.50</span></p>
                        </div>
                        <div class="fill-progress-info">已填报 X/Y 个字段</div>
                    </div>

                    <div class="action-block">
                        <button class="btn btn-primary btn-export-filled-doc">导出已填报文档</button>
                        <div class="feedback-message"></div>
                    </div>
                    <!-- 管理已保存填报进度/模板等功能可以归入管理中心 -->

                    <!-- 智能填报相关输入及按钮 -->
                    <div class="input-group">
                        <label for="fill-file-input">上传待填报文档:</label>
                        <input type="file" id="fill-file-input" class="input-file">
                    </div>
                    <div class="input-group">
                        <label for="material-file-input">上传补充材料:</label>
                        <input type="file" id="material-file-input" class="input-file" multiple>
                    </div>
                    <div id="fill-file-info" class="input-group hidden">
                        <span id="fill-file-name"></span>
                        <span id="fill-file-size"></span>
                    </div>
                    <button class="btn btn-primary" id="start-fill-btn">开始智能填报</button>
                    <div id="fill-result-section" class="result-block hidden">
                        <div id="fill-result-content"></div>
                    </div>
                </section>

                <!-- --- 场景：文档审阅 --- -->
                <section id="scene-review" class="scene-section hidden">
                    <h2 class="scene-title">文档审阅与修改</h2>
                    <p class="scene-description">获取专业审阅意见，并轻松管理修改。</p>

                    <div class="workflow-block">
                        <h3 class="workflow-title">1. 上传文档</h3>
                        <div class="input-group">
                            <label for="upload-review-doc">上传文档:</label>
                            <input type="file" id="upload-review-doc" class="input-file">
                            <span class="input-file-name"></span>
                        </div>
                    </div>

                    <div class="workflow-block">
                        <h3 class="workflow-title">2. 发起审阅</h3>
                        <div class="input-group">
                            <label for="review-focus-select">审阅侧重点:</label>
                            <select id="review-focus-select" class="input-select">
                                <option value="auto">AI智能推荐</option>
                                <option value="academic">学术风格</option>
                                <option value="business">商务报告</option>
                            </select>
                        </div>
                        <button class="btn btn-primary btn-start-review">发起审阅</button>
                    </div>

                    <!-- 审阅结果展示区 -->
                    <div class="review-results-block hidden">
                        <h3 class="result-title">审阅意见与修改</h3>
                        <div class="review-layout">
                            <div class="document-preview-placeholder review-preview">
                                <!-- 模拟文档，标记问题点 -->
                                <p>原文第一段。</p>
                                <p class="issue-marker" data-issue-id="issue1">此处表达不够正式。</p>
                                <p class="issue-marker" data-issue-id="issue2">这段内容可以精简。</p>
                            </div>
                            <div class="sidebar-suggestions">
                                <h4 class="sidebar-title">审阅建议</h4>
                                <div class="suggestion-item" data-issue-id="issue1">
                                    <div class="suggestion-header">
                                        <strong>建议 1:</strong> 风格 <span class="suggestion-type">(风格)</span>
                                        <button class="btn-toggle-details">▼</button>
                                    </div>
                                    <div class="suggestion-details">
                                        <p>原: "很棒" -> 改为: "优异"</p>
                                        <div class="suggestion-actions">
                                            <button class="btn btn-small btn-accept-issue">接受</button>
                                            <button class="btn btn-small btn-reject-issue">拒绝</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="suggestion-item" data-issue-id="issue2">
                                    <div class="suggestion-header">
                                        <strong>建议 2:</strong> 内容精简 <span class="suggestion-type">(逻辑)</span>
                                        <button class="btn-toggle-details">▼</button>
                                    </div>
                                    <div class="suggestion-details">
                                        <p>此段落包含冗余信息，建议移除。</p>
                                        <div class="suggestion-actions">
                                            <button class="btn btn-small btn-accept-issue">接受</button>
                                            <button class="btn btn-small btn-reject-issue">拒绝</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- ... -->
                                <div class="batch-actions">
                                    <button class="btn btn-secondary btn-accept-all-issues">接受所有建议</button>
                                    <button class="btn btn-danger btn-reject-all-issues">拒绝所有建议</button>
                                </div>
                            </div>
                        </div>
                        <div class="action-block">
                            <button class="btn btn-primary btn-export-reviewed-doc">导出审阅后文档</button>
                            <div class="feedback-message"></div>
                        </div>
                    </div>
                </section>

                <!-- --- 场景：管理中心 --- -->
                <section id="scene-manage" class="scene-section hidden">
                    <h2 class="scene-title">管理中心</h2>
                    <p class="scene-description">管理您的格式、文风和操作历史。</p>
                    
                    <div class="manage-tabs">
                        <button class="btn-tab active" data-tab="formats">格式</button>
                        <button class="btn-tab" data-tab="styles">文风</button>
                        <button class="btn-tab" data-tab="history">历史</button>
                    </div>

                    <div class="tab-content active" data-tab-content="formats">
                        <h3 class="tab-title">已保存格式</h3>
                        <ul class="manage-list">
                            <li class="manage-item">
                                <span class="item-name">公司报告模板 V1</span>
                                <div class="item-actions">
                                    <button class="btn btn-small btn-edit-name">重命名</button>
                                    <button class="btn btn-small btn-delete">删除</button>
                                </div>
                            </li>
                            <li class="manage-item">
                                <span class="item-name">合同标准</span>
                                <div class="item-actions">
                                    <button class="btn btn-small btn-edit-name">重命名</button>
                                    <button class="btn btn-small btn-delete">删除</button>
                                </div>
                            </li>
                            <!-- ... -->
                        </ul>
                    </div>
                    <div class="tab-content" data-tab-content="styles">
                        <h3 class="tab-title">已保存文风</h3>
                        <ul class="manage-list">
                            <li class="manage-item">
                                <span class="item-name">商务正式</span>
                                <div class="item-actions">
                                    <button class="btn btn-small btn-edit-name">重命名</button>
                                    <button class="btn btn-small btn-delete">删除</button>
                                </div>
                            </li>
                            <li class="manage-item">
                                <span class="item-name">学术简洁</span>
                                <div class="item-actions">
                                    <button class="btn btn-small btn-edit-name">重命名</button>
                                    <button class="btn btn-small btn-delete">删除</button>
                                </div>
                            </li>
                            <!-- ... -->
                        </ul>
                    </div>
                    <div class="tab-content" data-tab-content="history">
                        <h3 class="tab-title">操作历史</h3>
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>类型</th><th>内容</th><th>时间</th><th>状态</th><th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>格式统一</td><td>新文档.docx</td><td>10:30</td><td>成功</td><td><button class="btn btn-small btn-reapply">重试</button></td>
                                </tr>
                                <tr>
                                    <td>文风统一</td><td>草稿.docx</td><td>09:15</td><td>成功</td><td><button class="btn btn-small btn-reapply">重试</button></td>
                                </tr>
                                <!-- ... -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </main>

        <!-- 3. Footer -->
        <footer class="app-footer">
            <div class="container">
                <p>&copy; 2023 智能文档助手. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <script src="/static/js/app.js"></script>
    <!-- 扩展功能/辅助功能相关占位元素（自动补齐） -->
    <div id="style-templates-management" class="hidden"></div>
    <span id="analysis-mode-badge" class="badge hidden"></span>
    <button id="toggle-debug" class="btn btn-secondary hidden">调试</button>
    <div id="debug-details" class="debug-details hidden"></div>
    <section id="supplementary-materials-section" class="hidden"></section>
    <ul id="materials-list" class="hidden"></ul>
    <button id="continue-without-materials" class="btn btn-secondary hidden">无材料继续</button>
    <button id="continue-with-materials" class="btn btn-primary hidden">有材料继续</button>
    <button id="skip-style-setting" class="btn btn-secondary hidden">跳过文风设置</button>
    <button id="start-conversation" class="btn btn-primary hidden">开始对话</button>
    <button id="send-message" class="btn btn-primary hidden">发送消息</button>
    <input id="user-input" class="input-text hidden" placeholder="请输入消息" />
    <button id="download-filled-doc" class="btn btn-secondary hidden">下载已填报文档</button>
    <button id="restart-fill" class="btn btn-secondary hidden">重新填报</button>
    <section id="writing-style-section" class="hidden"></section>
    <ul id="style-templates-list" class="hidden"></ul>
    <section id="conversation-section" class="hidden"></section>
    <div id="ai-thinking-container" class="hidden"></div>
    <div id="conversation-history" class="hidden"></div>
    <span id="progress-text" class="hidden"></span>
    <div id="fill-progress-bar" class="progress-bar hidden"></div>
    <!-- 自动补齐：代码用到但页面未覆盖的id占位元素 -->
    <div id="ai-suggestions" style="display:none;"></div>
    <div id="analysis-result" style="display:none;"></div>
    <button id="analyze-btn" style="display:none;"></button>
    <div id="document-content" style="display:none;"></div>
    <div id="fill-upload-area" style="display:none;"></div>
    <button id="refresh-templates" style="display:none;"></button>
    <button id="save-style-template" style="display:none;"></button>
    <button id="test-style-generation" style="display:none;"></button>
    <div id="upload-format-base" style="display:none;"></div>
</body>
</html>
