<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI功能测试页面</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">AI功能测试页面</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">测试AI分析功能</h2>
            <button id="testBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                测试AI功能
            </button>
        </div>
        
        <div id="results" class="space-y-4">
            <!-- 结果将在这里显示 -->
        </div>
    </div>

    <script>
        document.getElementById('testBtn').addEventListener('click', async function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="bg-blue-50 p-4 rounded">正在测试AI功能...</div>';
            
            try {
                // 创建一个模拟的FormData
                const formData = new FormData();
                
                // 创建一个模拟的文本文件
                const testContent = `
                会议纪要
                时间：2024年6月24日
                参会人员：张三、李四、王五
                
                会议议题：
                1. 产品功能优化讨论
                2. 技术架构升级方案
                3. 市场推广策略
                
                讨论内容：
                针对当前产品的用户反馈，我们需要对核心功能进行优化。
                技术团队提出了新的架构方案，预计可以提升30%的性能。
                市场部门建议加强数字化营销投入。
                
                决策结果：
                1. 批准技术架构升级，预算100万
                2. 产品功能优化排期确定
                3. 市场推广预算增加50万
                
                后续行动：
                - 技术团队下周开始架构升级
                - 产品团队本月完成功能优化
                - 市场团队制定详细推广计划
                `;
                
                const blob = new Blob([testContent], { type: 'text/plain' });
                formData.append('file', blob, 'test_meeting.txt');
                formData.append('api_type', 'mock');
                formData.append('model_name', 'mock-model');
                
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('AI分析结果:', data);
                
                // 显示结果
                displayResults(data);
                
            } catch (error) {
                console.error('测试失败:', error);
                resultsDiv.innerHTML = `<div class="bg-red-50 p-4 rounded text-red-700">测试失败: ${error.message}</div>`;
            }
        });
        
        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            
            if (!data.success || !data.result) {
                resultsDiv.innerHTML = '<div class="bg-red-50 p-4 rounded text-red-700">处理失败</div>';
                return;
            }
            
            const result = data.result;
            let html = '<div class="bg-green-50 p-4 rounded text-green-700 mb-4">AI功能测试成功！</div>';
            
            // 显示各种AI分析结果
            const sections = [
                { title: '智能摘要', key: 'content_summary' },
                { title: '文档结构', key: 'structure_info' },
                { title: '场景分析', key: 'scenario_analysis' },
                { title: '关键实体', key: 'key_entities' },
                { title: '内容分析', key: 'content_analysis' },
                { title: '质量评估', key: 'quality_assessment' },
                { title: 'AI功能', key: 'ai_features_used' },
                { title: '优化建议', key: 'suggestions' }
            ];
            
            sections.forEach(section => {
                if (result[section.key]) {
                    html += createResultCard(section.title, result[section.key]);
                }
            });
            
            resultsDiv.innerHTML = html;
        }
        
        function createResultCard(title, data) {
            let content = '';
            
            if (Array.isArray(data)) {
                content = data.map((item, index) => {
                    if (typeof item === 'object') {
                        return `<div class="mb-2"><strong>${index + 1}:</strong> ${JSON.stringify(item)}</div>`;
                    }
                    return `<div class="mb-2"><strong>${index + 1}:</strong> ${item}</div>`;
                }).join('');
            } else if (typeof data === 'object') {
                content = Object.entries(data).map(([key, value]) => {
                    let displayValue = value;
                    if (Array.isArray(value)) {
                        displayValue = value.join(', ');
                    } else if (typeof value === 'object') {
                        displayValue = JSON.stringify(value);
                    }
                    return `<div class="mb-2"><strong>${key}:</strong> ${displayValue}</div>`;
                }).join('');
            } else {
                content = `<div>${data}</div>`;
            }
            
            return `
                <div class="bg-white rounded-lg shadow p-4 mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">${title}</h3>
                    <div class="text-gray-600">${content}</div>
                </div>
            `;
        }
    </script>
</body>
</html>
