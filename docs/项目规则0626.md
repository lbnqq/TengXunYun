# 项目规则 (2025年6月26日)

## 📋 规则概述

本文档将 Office-Doc-Agent 项目的开发规范重新表述为项目规则，旨在为所有项目成员提供明确的行为准则和操作指南。这些规则基于《项目开发规范》(v1.0, 2025年6月25日制定)，涵盖了工作流程、文档管理、代码编写、测试执行、协作方式以及质量保证等各个方面。所有团队成员必须严格遵守这些规则，以确保项目的高质量推进和一致性。

本规则文档以命令式语言表述各项要求，强调必须执行的操作和禁止的行为。通过将规范转化为规则，本文档旨在增强团队成员对项目标准的理解和执行力，确保项目开发过程中的每个环节都符合既定要求。规则适用于所有项目成员，包括开发人员、测试人员、文档负责人以及AI助手。

## 📅 规则制定与时间戳

本规则文档的生成时间为2025年6月26日，基于《项目开发规范》的内容进行重新表述。规则的制定依据包括项目当前状态全貌报告(2024年12月25日)以及截至2025年6月25日的状态检测结果。本文档将作为项目成员日常工作的指导手册，任何违反规则的行为都将按照规定的处理措施进行纠正。

在制定规则的过程中，特别考虑了项目当前面临的挑战和改进需求，例如文档审核滞后、测试报告管理不规范等问题。以下章节将详细阐述各项规则的具体内容和执行要求。

## 🔄 工作流程规则

### 文档先行规则

所有开发工作必须严格遵循"文档先行"原则，具体步骤如下。团队成员不得在未完成文档的情况下直接进行代码实现，否则将被视为违规行为。

- 必须在每次工作前执行项目状态检测，识别文件变更、依赖更新和配置修改。
- 必须编写需求文档，明确功能需求和验收标准。
- 必须完成设计文档，详细描述技术方案、架构设计和接口定义。
- 必须在代码实现后进行测试验证，确保功能符合需求。
- 必须在每次重大变更后编写变更文档，记录修改内容和影响范围。
- 必须使用项目提供的检测脚本进行状态检测，不得手动检查或跳过此步骤。

### 开发流程规则

分支管理和代码提交必须遵循以下规则，以确保代码库的清晰性和可追溯性。任何不遵守分支策略或提交格式的行为都将被要求重新提交。

- 必须使用规定的分支结构：`main`为生产分支，`develop`为开发分支，功能分支命名为`feature/功能名称`，热修复分支命名为`hotfix/修复名称`，发布分支命名为`release/版本号`。
- 必须在提交代码时使用规定的提交格式，格式为`类型(范围): 简短描述`，并包含详细描述、署名、AI辅助情况和测试状态。
- 提交类型必须从以下选项中选择：`feat`（新功能）、`fix`（修复bug）、`docs`（文档更新）、`style`（代码格式调整）、`refactor`（代码重构）、`test`（测试相关）、`chore`（构建/工具相关）。
- 不得将未经测试的代码直接合并到`main`或`develop`分支，必须先通过测试验证。

## 📝 文档规则

### 文档结构规则

所有项目文档必须遵循以下结构标准，不得随意更改模板或省略必要字段。文档负责人必须确保文档内容的完整性和准确性。

- README文档必须包含以下章节：项目概述、快速开始、项目架构、API文档、测试指南、贡献指南、许可证，并标注最后更新日期、更新人和版本号。
- 技术文档必须使用规定的模板，包含文档信息（创建时间、创建人、最后更新、更新人、版本、状态）、目标和范围、技术方案、实现细节、测试计划、性能指标、风险评估等章节。
- 所有文档必须在发布前完成审核流程，不得将未审核文档作为正式参考。

### 代码注释规则

代码注释必须符合以下要求，开发人员不得提交缺少必要注释的代码。注释的完整性将在代码审查中作为重要检查项。

- 每个文件必须包含文件头注释，格式为：模块名称和简短描述、详细功能描述、作者、创建时间、最后修改时间、修改人、AI辅助情况、版本、许可证。
- 每个函数或类必须包含详细注释，包含简短描述、详细功能说明、参数描述、返回值描述、异常情况描述、示例代码、特殊说明、作者、日期、AI辅助情况。
- 重要代码段必须添加注释，格式为：功能模块名称、作者、日期、AI辅助情况、详细描述，不得省略对复杂逻辑的解释。
- 必须使用规定的标记注释待办事项或问题，如`TODO`、`FIXME`、`HACK`、`NOTE`，并标注负责人或优先级。

## 💻 代码规则

### Python代码规则

Python代码必须严格遵守以下规则，确保代码风格一致性和可读性。任何不符合规则的代码将被要求修改后重新提交。

- 必须使用UTF-8编码，缩进必须为4个空格，行长度不得超过88字符。
- 命名必须遵循snake_case（函数、变量）和PascalCase（类）的规则。
- 导入语句必须按标准库、第三方库、本地模块分组，不得混杂排列。
- 所有函数必须包含类型注解，使用`typing`模块定义参数和返回值类型。
- 错误处理必须使用`try-except`结构，捕获具体异常并记录错误日志，不得使用空`except`语句。

### JavaScript代码规则

JavaScript代码必须遵循以下规则，确保前端代码的规范性和可维护性。代码审查将严格检查这些规则的执行情况。

- 必须使用UTF-8编码，缩进必须为2个空格，必须使用分号，优先使用单引号。
- 命名必须使用camelCase，不得使用保留字或不清晰的缩写。
- 函数定义必须包含JSDoc注释，描述功能、参数、返回值、作者、日期、AI辅助情况。

### 数据库规则

数据库设计必须遵守以下规则，确保数据结构的清晰性和一致性。任何不符合规则的数据库变更必须在实施前进行审查。

- 表名必须使用snake_case格式，并按模块分类添加前缀（如`user_`、`doc_`）。
- 字段命名必须遵循规则：主键为`id`，外键为`表名_id`，时间字段为`created_at`、`updated_at`、`deleted_at`，状态字段为`status`、`is_active`、`is_deleted`。
- 不得直接修改生产环境数据库结构，必须先在测试环境验证。

## 🧪 测试规则

### 测试分类规则

测试必须按照以下分类和要求组织和执行，测试负责人必须确保测试覆盖率和质量达到标准。任何未达到覆盖率要求的代码不得发布。

- 单元测试必须覆盖率不低于80%，文件名必须以`test_功能名称.py`格式命名，存放于`tests/unit/`目录。
- 集成测试必须覆盖API接口和数据库操作，文件名必须以`test_integration_模块名.py`格式命名，存放于`tests/integration/`目录。
- 端到端测试必须覆盖完整业务流程，文件名必须以`test_e2e_场景名.py`格式命名，存放于`tests/e2e/`目录。

### 测试代码规则

测试代码必须遵循以下格式和结构，确保测试用例的可读性和可维护性。测试代码的质量将在审查中作为重要评估标准。

- 测试类必须包含描述、作者、日期、AI辅助情况等注释。
- 每个测试类必须实现`setUp`和`tearDown`方法，用于准备测试数据和清理资源。
- 测试方法必须以`test_`开头，名称应清晰描述测试内容，内部结构必须分为Given、When、Then三个逻辑部分。

## 👥 协作规则

### 代码审查规则

代码审查必须严格执行以下流程和检查清单，任何未通过审查的代码不得合并。审查人必须对审查结果负责。

- 必须完成审查清单中的所有检查项，包括代码规范、注释完整性、测试覆盖率、性能影响评估、安全风险检查、文档更新完整性。
- 审查流程必须包括：提交PR（包含完整描述和测试结果）、自动检查（CI/CD流水线验证）、人工审查（至少1人审查通过）、合并代码。
- 不得绕过审查流程直接合并代码，违者将被视为严重违规。

### 问题跟踪规则

问题报告必须使用规定的Issue模板，确保信息的完整性和可追溯性。报告人必须提供所有必要信息，以便于问题复现和解决。

- Issue必须包含问题描述、复现步骤、期望结果、实际结果、环境信息、附加信息（如错误日志、截图）。
- 必须标注报告人、报告时间、优先级（高/中/低）和标签（bug/enhancement/question）。

## 📊 质量保证规则

### 代码质量检查规则

代码质量检查必须使用规定的自动化工具执行，开发人员不得提交未通过检查的代码。质量检查结果必须记录并定期回顾。

- 必须使用以下工具检查Python代码：`flake8`（行长度限制88）、`black`（格式检查）、`mypy`（类型检查）。
- 必须使用以下工具检查JavaScript代码：`eslint`、`prettier`（格式检查）。
- 必须使用`bandit`和`safety`进行安全检查，确保无重大漏洞。
- 性能指标必须符合要求：API响应时间小于2秒，峰值内存小于1GB，平均CPU使用率小于70%，错误率小于1%。

### 发布流程规则

发布必须严格遵循以下检查清单和版本管理规则，任何未完成检查的发布将被视为无效。发布负责人必须确保流程完整性。

- 发布前必须完成以下检查：所有测试通过、代码审查完成、文档更新完整、性能测试通过、安全扫描通过、数据备份完成。
- 版本号必须遵循格式`主版本.次版本.修订版本-预发布版本`，其中主版本表示不兼容API修改，次版本表示向下兼容功能新增，修订版本表示向下兼容问题修正。

## 🔧 工具与环境规则

### 开发环境规则

开发环境必须符合以下配置要求，开发人员不得使用不符合版本要求的工具或环境。环境配置问题导致的开发错误将由个人负责。

- 必须使用Python >= 3.12，pip >= 23.0。
- 必须安装代码质量工具：`black >= 23.0`、`flake8 >= 6.0`、`mypy >= 1.0`。
- 必须安装测试工具：`pytest >= 7.0`、`coverage >= 7.0`。
- 必须使用虚拟环境进行开发，激活命令为`source venv/bin/activate`（Linux/Mac）或`venv\Scripts\activate`（Windows）。
- 必须使用`pre-commit >= 3.0`进行Git提交前检查。

### CI/CD配置规则

CI/CD流水线必须按照以下配置执行，任何未通过流水线验证的代码不得合并。流水线配置的变更必须经过技术负责人审批。

- 必须在GitHub Actions中配置CI/CD流水线，触发条件为`push`和`pull_request`。
- 流水线必须包含以下步骤：代码检出、Python环境设置、依赖安装、测试运行、代码质量检查（`flake8`、`black`、`mypy`）。

## 📋 规则执行与违规处理

### 培训与推广规则

新成员入职和规则推广必须遵循以下流程，确保所有成员了解并遵守规则。培训负责人必须记录培训完成情况。

- 新成员必须接受2小时规则培训，并在1周内完成导师指导和示例任务考核。
- 必须每月进行规则执行情况回顾，季度优化规则内容，年度评估规则效果。

### 违规处理规则

违规行为必须按照以下等级和处理措施进行处理，违规记录将作为绩效评估依据。处理措施必须公平执行，不得有例外。

- 轻微违规（如代码格式、注释不规范）：提醒改正。
- 一般违规（如缺少测试、文档不完整）：要求重新提交。
- 严重违规（如未经审查提交、破坏性修改）：回滚代码，团队讨论处理方案。

## 📞 联系与反馈规则

规则相关问题和反馈必须通过以下渠道提交，团队成员不得私下解决规则争议。反馈必须及时处理并记录结果。

- 必须通过邮箱`dev-standards@company.com`或内部群"开发规范讨论群"提交规则问题。
- 必须在GitHub Issues中提交规则相关Issue，标注优先级和标签。
- 规则维护团队联系方式：技术负责人、质量负责人、文档负责人，具体信息参见《项目开发规范》。

## 🛠️ 快速开始规则

新成员或日常开发必须遵循以下快速开始流程，确保环境设置和开发流程符合规则要求。任何未完成流程的开发行为将被视为违规。

- 必须克隆项目后运行`python setup_dev_environment.py`设置环境。
- 必须激活虚拟环境后进行开发。
- 必须在开发前运行`python tools/project_status_checker.py`进行状态检测。
- 必须使用`python tools/code_template_generator.py`生成代码模板。
- 必须在提交前运行质量检查和测试脚本（`scripts/quality_check.sh`和`scripts/run_tests.sh`）。

## 🤖 AI遵守规则承诺

AI助手必须严格遵守以下规则，确保生成内容和操作符合项目要求。任何AI违规行为将记录并由技术负责人处理。

- 必须在每次工作前进行项目状态检测，制定详细文档。
- 必须基于时间戳进行增量检测，避免重复工作。
- 必须在所有生成或修改的代码中包含AI署名信息（"AI Assistant (Claude)"）和AI辅助声明。
- 必须记录操作的用户信息和时间戳。
- 必须在工作完成后进行全面测试验证。
- 必须生成符合规范的Git提交指令，供用户执行。

## 📋 结论

本项目规则文档将《项目开发规范》转化为明确的指导准则，为Office-Doc-Agent项目的开发、测试、文档和协作等方面提供了必须遵守的行为标准。所有团队成员，包括AI助手，必须严格执行这些规则，确保项目在规范框架内高效推进。

在未来的工作中，团队必须持续关注规则的执行情况，定期进行回顾和优化，确保规则与项目需求保持一致。同时，建议加强规则培训和工具支持，提升团队对规则的理解和执行力，以保证项目质量和开发效率。

## 四位一体自动化校验规则
- 所有接口、页面元素、AI代码、测试脚本必须自动化校验一致性，变更需同步。
- 合并前必须通过接口、页面、AI代码、测试脚本一致性校验。

## 持续集成与三位一体测试规则
- 代码提交必须通过CI自动化测试（单元、集成、端到端、可用性）。
- 自动化测试覆盖主流程、异常、边界、权限、性能。
- 定期人工体验测试补充。

## 命名规范、组件化、接口文档、变更同步
- 元素id/class、API、AI代码、测试脚本命名规范化，维护对照表。
- 前端组件化开发，接口变更需同步更新所有相关文档和代码。

## AI代码自动校验与测试
- AI生成代码后自动运行linter、类型检查、自动化测试，未通过禁止合并。
- AI生成测试用例需覆盖主流程、异常、边界。

## 问题复盘与持续改进
- 每次问题复盘后，及时补充规范、测试、自动化脚本，形成持续改进闭环。

## API返回与前端健壮性强制规则
- 后端所有API无论成功失败，均返回统一结构化JSON，绝不允许HTML错误页或未定义结构。
- 前端所有API调用点必须做类型和存在性检查，任何数组操作、对象属性访问前先判断类型和存在性。
- 所有异常和错误都必须被优雅兜底和用户友好提示，用户永远不会看到页面崩溃。
- 自动化测试和代码评审必须覆盖所有主流程和异常分支。
- 定期复盘线上异常，持续补充兜底和测试用例。

### 自动化测试与路径规范
- 所有测试主控脚本（如run_comprehensive_tests.py）必须保证在项目根目录下可一键全量运行。
- 所有被subprocess等方式调用的测试脚本路径，必须加上tests/前缀，确保无论本地还是CI环境均能正确找到并执行。
- 依赖文件（如requirements.txt、templates、static等）路径查找需兼容根目录运行，避免因路径问题导致测试失败。

---
**规则制定人**: AI Assistant (Claude)  
**制定时间**: 2025年6月26日  
**版本**: v1.0  
**状态检测**: 已完成 (2025-06-26 09:35:00)  
**审核状态**: 待审核
