# 细粒度意图判定与用户反馈机制设计

## 🎯 背景与目标

为提升智能文档助手的业务智能化和用户体验，需对文档意图判定进行细粒度扩展，并引入用户反馈闭环，支持更丰富的业务场景和持续优化。

- **目标1**：支持合同模板、学术论文草稿、AIGC痕迹+内容不全等更细粒度的意图类型。
- **目标2**：判定规则和推荐操作可灵活扩展，前后端联动。
- **目标3**：置信度阈值支持配置化，便于不同场景灵活调整。
- **目标4**：后端记录判定日志，前端支持用户反馈，形成优化闭环。

---

## 1. 细粒度意图类型扩展方案

### 1.1 新增意图类型
- `contract_template`：合同模板/合同草稿
- `paper_draft`：学术论文草稿
- `aigc_incomplete`：AIGC痕迹+内容不全
- （可扩展更多业务场景类型）

### 1.2 判定规则举例
- **合同模板**：检测"合同""甲方""乙方""签章"等关键词，结构上有条款编号、签署区。
- **论文草稿**：检测"摘要""引言""方法""结论"等学术结构，或"参考文献"区块。
- **AIGC+内容不全**：AIGC痕迹（AI常用短语/结构）+内容缺失标记（如"待补充""TODO"）。

---

## 2. 判定规则与推荐操作

| 意图类型           | 判定特征（示例）                                   | 推荐操作                   | 前端引导文案示例                 |
|--------------------|----------------------------------------------------|----------------------------|----------------------------------|
| contract_template  | 合同关键词、条款编号、签章区                       | 启动合同智能填报/审核      | 检测到合同模板，是否进入智能填报？|
| paper_draft        | 论文结构关键词、参考文献区块                        | 启动论文格式/内容优化      | 检测到论文草稿，是否进行优化？    |
| aigc_incomplete    | AIGC痕迹+内容缺失标记                              | 风格改写+内容补全          | 检测到AI生成痕迹和内容不全，是否优化？|
| ...                | ...                                                | ...                        | ...                              |

---

## 3. 置信度阈值配置化方案

- 在`config/config.yaml`新增：
```yaml
intent_confidence_thresholds:
  fill_form: 0.8
  format_cleanup: 0.7
  content_completion: 0.6
  style_rewrite: 0.5
  contract_template: 0.85
  paper_draft: 0.75
  aigc_incomplete: 0.7
```
- 后端分类器初始化时自动加载，判定逻辑动态读取。

---

## 4. 日志与用户反馈机制

### 4.1 判定日志
- 每次意图判定写入`logs/intent_analysis.log`，内容包括：文档名、判定意图、置信度、特征证据、时间戳、用户反馈（如有）。

### 4.2 用户反馈
- 前端弹窗增加"判定是否准确"按钮（准确/不准确），支持用户纠正（下拉选择新意图）。
- 新增API：`POST /api/intent-feedback`，参数包括：文档名、原判定意图、用户反馈结果、纠正后意图、时间戳。
- 后端记录反馈到日志或数据库，供后续优化。

---

## 5. 接口与前端交互设计

### 5.1 API接口
- `/api/upload`：上传文档，返回细粒度意图判定结果、置信度、推荐操作。
- `/api/intent-feedback`：接收用户反馈。

### 5.2 前端弹窗
- 显示：判定意图、置信度、推荐操作、引导文案。
- 反馈区：准确/不准确，支持纠正。

---

## 6. 落地计划

1. 后端扩展意图类型与判定规则，支持配置化阈值。
2. 新增日志与反馈API，完善日志记录。
3. 前端弹窗支持反馈与纠正，完善引导文案。
4. 联调测试，完善文档与用例。

---

## 7. 兼容性与扩展性说明
- 所有新类型和规则均支持后续扩展。
- 阈值、文案、推荐操作均可配置。
- 日志与反馈机制支持后续数据分析与模型优化。 