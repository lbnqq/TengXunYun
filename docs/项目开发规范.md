# Office-Doc-Agent 项目开发规范

## 📋 规范概述

**制定时间**: 2025年6月25日  
**制定依据**: 项目当前状态全貌报告 (2024年12月25日)  
**适用范围**: 所有项目成员  
**版本**: v1.0  

---

## 🔄 工作流程规范

### 1. 文档先行原则

**所有开发工作必须遵循"文档先行"原则**：

```
1. 📊 状态检测 → 2. 📝 需求文档 → 3. 🏗️ 设计文档 → 4. 💻 代码实现 → 5. 🧪 测试验证 → 6. 📦 Git提交
```

#### 1.1 状态检测要求
- **每次工作前**必须进行项目状态检测
- **增量检测**：基于上次文档时间戳检测变更
- **检测内容**：文件变更、依赖更新、配置修改
- **检测工具**：使用项目提供的检测脚本

#### 1.2 文档要求
- **需求文档**：明确功能需求、验收标准
- **设计文档**：技术方案、架构设计、接口定义
- **变更文档**：记录所有修改内容和影响范围

### 2. 开发流程规范

#### 2.1 分支管理
```
main (生产分支)
├── develop (开发分支)
├── feature/功能名称 (功能分支)
├── hotfix/修复名称 (热修复分支)
└── release/版本号 (发布分支)
```

#### 2.2 提交规范
```bash
# 提交格式
git commit -m "类型(范围): 简短描述

详细描述
- 修改内容1
- 修改内容2

署名: [用户名] [时间]
AI辅助: [是/否] [AI模型]
测试状态: [通过/失败]
"
```

**提交类型**：
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 构建/工具相关

---

## 📝 文档规范

### 1. 文档结构标准

#### 1.1 README文档
```markdown
# 项目名称

## 📋 项目概述
## 🚀 快速开始
## 🏗️ 项目架构
## 📖 API文档
## 🧪 测试指南
## 🤝 贡献指南
## 📄 许可证

---
**最后更新**: [日期]  
**更新人**: [姓名]  
**版本**: [版本号]
```

#### 1.2 技术文档模板
```markdown
# 文档标题

## 📋 文档信息
- **创建时间**: YYYY-MM-DD
- **创建人**: [姓名]
- **最后更新**: YYYY-MM-DD
- **更新人**: [姓名]
- **版本**: v1.0
- **状态**: [草稿/审核中/已发布]

## 🎯 目标和范围
## 🏗️ 技术方案
## 📊 实现细节
## 🧪 测试计划
## 📈 性能指标
## 🔍 风险评估

---
**审核人**: [姓名]  
**审核时间**: [日期]  
**审核状态**: [通过/需修改]
```

### 2. 代码注释规范

#### 2.1 文件头注释
```python
#!/usr/bin/env python3
"""
模块名称和简短描述

详细描述模块的功能、用途和主要特性。

Author: [作者姓名]
Created: YYYY-MM-DD
Last Modified: YYYY-MM-DD
Modified By: [修改人姓名]
AI Assisted: [是/否] - [AI模型名称]
Version: v1.0
License: MIT
"""
```

#### 2.2 函数/类注释
```python
def function_name(param1: str, param2: int) -> bool:
    """
    函数简短描述
    
    详细描述函数的功能、算法逻辑和使用场景。
    
    Args:
        param1 (str): 参数1的描述
        param2 (int): 参数2的描述
    
    Returns:
        bool: 返回值的描述
    
    Raises:
        ValueError: 异常情况的描述
        
    Example:
        >>> function_name("test", 123)
        True
        
    Note:
        特殊说明或注意事项
        
    Author: [作者姓名]
    Date: YYYY-MM-DD
    AI Assisted: [是/否]
    """
```

#### 2.3 重要代码段注释
```python
# ==================== 功能模块名称 ====================
# 作者: [姓名]
# 日期: YYYY-MM-DD
# AI辅助: [是/否]
# 描述: 详细描述这段代码的功能和实现逻辑

# TODO: 待完成的功能 - [负责人] [截止日期]
# FIXME: 需要修复的问题 - [发现人] [优先级]
# HACK: 临时解决方案 - [实施人] [计划改进时间]
# NOTE: 重要说明 - [说明人] [日期]
```

---

## 💻 代码规范

### 1. Python代码规范

#### 1.1 基础规范
- **编码**: UTF-8
- **缩进**: 4个空格
- **行长度**: 最大88字符
- **命名**: snake_case (函数、变量)，PascalCase (类)
- **导入**: 按标准库、第三方库、本地模块分组

#### 1.2 类型注解
```python
from typing import List, Dict, Optional, Union, Any

def process_document(
    file_path: str,
    options: Dict[str, Any],
    timeout: Optional[int] = None
) -> Dict[str, Union[str, bool]]:
    """所有函数必须包含类型注解"""
    pass
```

#### 1.3 错误处理
```python
try:
    # 主要逻辑
    result = risky_operation()
except SpecificException as e:
    # 具体异常处理
    logger.error(f"操作失败: {e}")
    raise
except Exception as e:
    # 通用异常处理
    logger.error(f"未知错误: {e}")
    raise
finally:
    # 清理资源
    cleanup_resources()
```

### 2. JavaScript代码规范

#### 2.1 基础规范
- **编码**: UTF-8
- **缩进**: 2个空格
- **分号**: 必须使用
- **引号**: 单引号优先
- **命名**: camelCase

#### 2.2 函数定义
```javascript
/**
 * 函数描述
 * @param {string} param1 - 参数描述
 * @param {number} param2 - 参数描述
 * @returns {boolean} 返回值描述
 * @author [作者姓名]
 * @date YYYY-MM-DD
 * @ai_assisted [是/否]
 */
function functionName(param1, param2) {
  // 实现逻辑
}
```

### 3. 数据库规范

#### 3.1 表命名
- **格式**: snake_case
- **前缀**: 按模块分类 (如: user_, doc_, perf_)
- **示例**: `user_profiles`, `doc_processing_records`

#### 3.2 字段命名
- **主键**: `id` (自增整数)
- **外键**: `表名_id` (如: `user_id`)
- **时间**: `created_at`, `updated_at`, `deleted_at`
- **状态**: `status`, `is_active`, `is_deleted`

---

## 🧪 测试规范

### 1. 测试分类

#### 1.1 单元测试
- **覆盖率**: 最低80%
- **命名**: `test_功能名称.py`
- **位置**: `tests/unit/`

#### 1.2 集成测试
- **范围**: API接口、数据库操作
- **命名**: `test_integration_模块名.py`
- **位置**: `tests/integration/`

#### 1.3 端到端测试
- **范围**: 完整业务流程
- **命名**: `test_e2e_场景名.py`
- **位置**: `tests/e2e/`

### 2. 测试代码规范

```python
import unittest
from unittest.mock import Mock, patch

class TestDocumentProcessor(unittest.TestCase):
    """
    文档处理器测试类
    
    Author: [作者姓名]
    Date: YYYY-MM-DD
    AI Assisted: [是/否]
    """
    
    def setUp(self):
        """测试前置条件"""
        pass
    
    def tearDown(self):
        """测试后清理"""
        pass
    
    def test_process_valid_document(self):
        """测试处理有效文档"""
        # Given: 准备测试数据
        # When: 执行测试操作
        # Then: 验证结果
        pass
```

---

## 👥 协作规范

### 1. 代码审查

#### 1.1 审查清单
- [ ] 代码符合规范
- [ ] 注释完整准确
- [ ] 测试覆盖充分
- [ ] 性能影响评估
- [ ] 安全风险检查
- [ ] 文档更新完整

#### 1.2 审查流程
1. **提交PR**: 包含完整描述和测试结果
2. **自动检查**: CI/CD流水线验证
3. **人工审查**: 至少1人审查通过
4. **合并代码**: 审查通过后合并

### 2. 问题跟踪

#### 2.1 Issue模板
```markdown
## 问题描述
简要描述问题

## 复现步骤
1. 步骤1
2. 步骤2
3. 步骤3

## 期望结果
描述期望的正确行为

## 实际结果
描述实际发生的错误行为

## 环境信息
- 操作系统: 
- Python版本: 
- 浏览器: 

## 附加信息
- 错误日志
- 截图
- 相关文件

---
**报告人**: [姓名]  
**报告时间**: [日期]  
**优先级**: [高/中/低]  
**标签**: [bug/enhancement/question]
```

---

## 📊 质量保证

### 1. 代码质量检查

#### 1.1 自动化工具
```bash
# Python代码检查
flake8 src/ --max-line-length=88
black src/ --check
mypy src/

# JavaScript代码检查
eslint static/js/
prettier --check static/js/

# 安全检查
bandit -r src/
safety check
```

#### 1.2 性能监控
- **响应时间**: API响应时间 < 2秒
- **内存使用**: 峰值内存 < 1GB
- **CPU使用**: 平均CPU < 70%
- **错误率**: 错误率 < 1%

### 2. 发布流程

#### 2.1 发布检查清单
- [ ] 所有测试通过
- [ ] 代码审查完成
- [ ] 文档更新完整
- [ ] 性能测试通过
- [ ] 安全扫描通过
- [ ] 备份数据完成

#### 2.2 版本管理
```
主版本.次版本.修订版本-预发布版本
例如: 1.2.3-beta.1

主版本: 不兼容的API修改
次版本: 向下兼容的功能性新增
修订版本: 向下兼容的问题修正
```

---

## 🔧 工具配置

### 1. 开发环境配置

#### 1.1 必需工具
```bash
# Python环境
python >= 3.12
pip >= 23.0

# 代码质量工具
black >= 23.0
flake8 >= 6.0
mypy >= 1.0

# 测试工具
pytest >= 7.0
coverage >= 7.0

# Git工具
pre-commit >= 3.0
```

#### 1.2 IDE配置
- **VSCode**: 推荐配置文件 `.vscode/settings.json`
- **PyCharm**: 代码风格配置导出
- **插件**: Python、JavaScript、Git相关插件

### 2. CI/CD配置

#### 2.1 GitHub Actions
```yaml
# .github/workflows/ci.yml
name: CI/CD Pipeline
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Python
        uses: actions/setup-python@v4
      - name: Install dependencies
        run: pip install -r requirements.txt
      - name: Run tests
        run: pytest --cov=src/
      - name: Code quality check
        run: |
          flake8 src/
          black --check src/
          mypy src/
```

---

## 📋 规范执行

### 1. 培训和推广

#### 1.1 新成员入职
- **规范培训**: 2小时规范讲解
- **实践指导**: 1周导师指导
- **考核验证**: 完成示例任务

#### 1.2 定期回顾
- **月度回顾**: 规范执行情况检查
- **季度优化**: 规范内容更新优化
- **年度评估**: 规范效果全面评估

### 2. 违规处理

#### 2.1 违规等级
- **轻微违规**: 代码格式、注释不规范
- **一般违规**: 缺少测试、文档不完整
- **严重违规**: 未经审查提交、破坏性修改

#### 2.2 处理措施
- **轻微违规**: 提醒改正
- **一般违规**: 要求重新提交
- **严重违规**: 回滚代码，团队讨论

---

## 📞 联系方式

**规范维护团队**:
- **技术负责人**: [姓名] [邮箱]
- **质量负责人**: [姓名] [邮箱]
- **文档负责人**: [姓名] [邮箱]

**问题反馈**:
- **邮箱**: dev-standards@company.com
- **内部群**: 开发规范讨论群
- **Issue**: GitHub Issues

---

## 🛠️ 快速开始

### 1. 环境设置
```bash
# 1. 克隆项目
git clone <repository-url>
cd office-doc-agent

# 2. 运行自动化设置脚本
python setup_dev_environment.py

# 3. 激活虚拟环境（必须使用）
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate     # Windows

# 4. 验证设置
python tools/project_status_checker.py
python tools/check_file_headers.py src/
```

### 2. 日常开发流程
```bash
# 1. 创建功能分支
git checkout -b feature/功能名称

# 2. 状态检测（每次开发前 必须）
python tools/project_status_checker.py

# 3. 生成代码模板（可选）
python tools/code_template_generator.py python_module 模块名 "模块描述" --author "你的姓名" --output src/new_module.py

# 4. 开发代码...

# 5. 运行质量检查
scripts/quality_check.sh

# 6. 运行测试
scripts/run_tests.sh

# 7. 提交代码
git add .
git commit  # 使用配置的提交模板

# 8. 推送代码
git push origin feature/功能名称
```

## 🤖 AI遵守规范承诺

**是的，我（AI Assistant）承诺严格遵守以下规范**：

### ✅ AI工作流程承诺
1. **文档先行**: 每次工作前进行项目状态检测，制定详细文档
2. **增量检测**: 基于时间戳进行变更检测，避免重复工作
3. **署名备注**: 所有生成/修改的代码都包含AI署名信息
4. **用户记录**: 记录操作的用户信息和时间戳
5. **测试验证**: 工作完成后进行全面测试验证
6. **Git规范**: 生成符合规范的Git提交指令（需用户执行）

### 📝 AI代码生成规范
```python
# 所有AI生成的代码都包含以下信息：
"""
模块描述

Author: AI Assistant (Claude)
Created: YYYY-MM-DD
Last Modified: YYYY-MM-DD
Modified By: AI Assistant (Claude)
AI Assisted: 是 - Claude 3.5 Sonnet
Version: v1.0
License: MIT
"""

# 重要代码段注释格式：
# ==================== 功能模块名称 ====================
# 作者: AI Assistant (Claude)
# 日期: YYYY-MM-DD
# AI辅助: 是
# 描述: 详细描述这段代码的功能和实现逻辑
```

### 🔄 AI工作检查清单
- [ ] 项目状态检测完成
- [ ] 需求文档编写完成
- [ ] 技术方案设计完成
- [ ] 代码实现包含完整署名
- [ ] 测试用例编写完成
- [ ] 功能测试验证通过
- [ ] 文档更新完成
- [ ] Git提交指令生成

## 📋 工具使用指南

### 1. 项目状态检测工具
```bash
# 基础检测
python tools/project_status_checker.py

# 输出报告到文件
python tools/project_status_checker.py --output "状态报告.md"

# 不保存状态（仅查看）
python tools/project_status_checker.py --no-save
```

### 2. 代码模板生成工具
```bash
# 生成Python模块
python tools/code_template_generator.py python_module "模块名" "模块描述" --author "姓名" --ai-assisted

# 生成测试文件
python tools/code_template_generator.py test_file "测试名" "测试描述" --output tests/test_new.py

# 生成HTML页面
python tools/code_template_generator.py html_page "页面名" "页面描述" --output templates/new_page.html
```

### 3. 文件头检查工具
```bash
# 检查指定目录
python tools/check_file_headers.py src/

# 生成检查报告
python tools/check_file_headers.py src/ --report "检查报告.md"

# 严格模式（有错误就退出）
python tools/check_file_headers.py src/ --strict
```

---

**文档版本**: v1.0
**制定人**: AI Assistant (Claude)
**制定时间**: 2025年6月25日
**状态检测**: 已完成 (2025-06-25 10:44:40)
**工具验证**: 已通过 (文件头检查、状态检测)
**审核状态**: 待审核
**下次更新**: 2025年9月25日
